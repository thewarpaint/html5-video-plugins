(function(){var g={};
(function(window){var k,aa=this;function p(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function q(a,b){function c(){}c.prototype=b.prototype;a.cc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.bc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(){};function ca(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ca("error");ca("warn");ca("info");ca("log");ca("debug");function da(a){ea[a]={na:fa(),end:NaN}}function ga(a){if(a=ea[a])a.end=fa()}function ha(a){return(a=ea[a])&&a.end?a.end-a.na:NaN}var fa=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,ea={};function ia(a,b,c){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.active=!1}p("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function ja(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}ja.prototype.clone=function(){var a=new ja;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function r(){this.fontSize="100%";this.fontColor=ka;this.fontOpacity=la;this.backgroundColor=ma;this.backgroundOpacity=la;this.fontEdge=na}p("shaka.player.TextStyle",r);r.prototype.a=function(){var a=window.localStorage.getItem("ShakaPlayerTextStyle");if(a){var b;try{b=JSON.parse(a)}catch(c){return}if(b&&"object"==typeof b){var a=b,d;for(d in a)d in this&&(this[d]=a[d])}}};r.prototype.load=r.prototype.a;r.prototype.b=function(){window.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))};
r.prototype.store=r.prototype.b;function oa(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+pa(a.fontColor,a.fontOpacity));b.push("background-color: "+pa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(pa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function pa(a,b){return"rgba("+a.concat(b).join(",")+")"}var ka=[255,255,255],ma=[0,0,0];
r.StandardColors={WHITE:ka,BLACK:ma,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var la=1;r.StandardOpacities={OPAQUE:la,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var na=[];
r.EdgeStyles={NONE:na,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function qa(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}p("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ra(a,b,c,d){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.active=!1}function sa(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}p("shaka.player.VideoTrack.compare",sa);function ta(){var a="CustomEvent"in window;if(a)try{new CustomEvent("")}catch(b){a=!1}a||(window.CustomEvent=ua)}p("shaka.polyfill.CustomEvent.install",ta);function ua(a,b){var c=document.createEvent("CustomEvent"),d=b||{bubbles:!1,cancelable:!1,detail:null};c.initCustomEvent(a,!!d.bubbles,!!d.cancelable,d.detail);return c};function wa(){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen;a=Document.prototype;a.exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitExitFullscreen;"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}});document.addEventListener("webkitfullscreenchange",
xa);document.addEventListener("webkitfullscreenerror",xa);document.addEventListener("mozfullscreenchange",xa);document.addEventListener("mozfullscreenerror",xa);document.addEventListener("MSFullscreenChange",xa);document.addEventListener("MSFullscreenError",xa)}p("shaka.polyfill.Fullscreen.install",wa);function xa(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),b=new Event(b,a);a.target.dispatchEvent(b)};function ya(){return Promise.reject(Error("The key system specified is not supported."))}function za(a){return null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Aa(){throw new TypeError("Illegal constructor.");}Aa.prototype.createSession=function(){};Aa.prototype.setServerCertificate=function(){};function Ba(){throw new TypeError("Illegal constructor.");}Ba.prototype.getConfiguration=function(){};Ba.prototype.createMediaKeys=function(){};function w(a){this.c=[];this.b=[];this.ba=Ca;if(a)try{a(this.W.bind(this),this.a.bind(this))}catch(b){this.a(b)}}var Ca=0;function Da(){window.Promise||(window.Promise=w,window.Promise.resolve=Ea,window.Promise.reject=Fa,window.Promise.all=Ga,window.Promise.race=Ha,Ia=window.setImmediate?function(a){window.setImmediate(a)}:function(a){window.setTimeout(a,0)})}p("shaka.polyfill.Promise.install",Da);function Ea(a){var b=new w;b.W(a);return b}function Fa(a){var b=new w;b.a(a);return b}
function Ga(a){function b(a,b,c){a.ba==Ca&&(e[b]=c,d++,d==e.length&&a.W(e))}var c=new w;if(!a.length)return c.W([]),c;for(var d=0,e=Array(a.length),f=c.a.bind(c),g=0;g<a.length;++g)a[g].then?a[g].then(b.bind(null,c,g),f):b(c,g,a[g]);return c}function Ha(a){for(var b=new w,c=b.W.bind(b),d=b.a.bind(b),e=0;e<a.length;++e)a[e].then?a[e].then(c,d):c(a[e]);return b}
w.prototype.then=function(a,b){var c=new w;switch(this.ba){case 1:Ka(this,c,a);break;case 2:Ka(this,c,b);break;case Ca:this.c.push({Ia:c,Ba:a}),this.b.push({Ia:c,Ba:b})}return c};w.prototype.then=w.prototype.then;w.prototype.catch=function(a){return this.then(void 0,a)};w.prototype["catch"]=w.prototype.catch;w.prototype.W=function(a){if(this.ba==Ca){this.wa=a;this.ba=1;for(a=0;a<this.c.length;++a)Ka(this,this.c[a].Ia,this.c[a].Ba);this.c=[];this.b=[]}};
w.prototype.a=function(a){if(this.ba==Ca){this.wa=a;this.ba=2;for(a=0;a<this.b.length;++a)Ka(this,this.b[a].Ia,this.b[a].Ba);this.c=[];this.b=[]}};function Ka(a,b,c){Ia(function(){if(c&&"function"==typeof c){try{var a=c(this.wa)}catch(e){b.a(e);return}a instanceof w?a==b?b.a(new TypeError("Chaining cycle detected")):a.then(b.W.bind(b),b.a.bind(b)):b.W(a)}else 1==this.ba?b.W(this.wa):b.a(this.wa)}.bind(a))}function Ia(){};function La(){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=Ma)}p("shaka.polyfill.VideoPlaybackQuality.install",La);function Ma(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}};function Na(a,b){for(var c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function x(){return Date.now()+Oa}var Oa=0;function Pa(a){this.b=a;this.c=0==Qa;this.a=0}var Qa=1;function Ra(a){return a.a<a.b.byteLength}function Sa(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function y(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ta(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Ua(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function z(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Va(a){this.b=a;this.a=new Pa(a);Wa||(Wa=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Wa;
function Xa(a){var b;b=Ya(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=Ya(a);a:{for(d=0;d<Wa.length;d++)if(Za(c,Wa[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);z(a.a,c);return new $a(b,d)}function Ya(a){var b=Sa(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Sa(a.a);return d}function $a(a,b){this.id=a;this.a=b}
function ab(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};var bb={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function cb(a){this.c=Math.exp(Math.log(.5)/a);this.a=this.b=0}cb.prototype.sample=function(a,b){var c=Math.pow(this.c,a);this.b=b*(1-c)+c*this.b;this.a+=a};function db(a){return a.b/(1-Math.pow(a.c,a.a))};function A(a){var b=new CustomEvent(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function B(a){return new CustomEvent("error",{detail:a,bubbles:!0})};function eb(a,b,c){fb(b);fb(c);return c==b||a>=gb&&c==b.split("-")[0]||a>=hb&&c.split("-")[0]==b.split("-")[0]?!0:!1}var gb=1,hb=2;function fb(a){a=a.toLowerCase().split("-");var b=ib[a[0]];b&&(a[0]=b);return a.join("-")}
var ib={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function jb(a){return Object.keys(a).map(function(b){return a[b]})}function kb(a,b){var c=lb(a,b,"number");if(null==c)return null;if(isNaN(c)||c==Number.NEGATIVE_INFINITY||c==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(0>c)throw new RangeError("'"+b+"' must be >= 0");return c}function mb(a,b){return lb(a,b,"string")}function lb(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}
function nb(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function D(){this.a={}}D.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};D.prototype.set=function(a,b){this.a[a]=b};D.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function ob(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function pb(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function qb(a){var b=[],c;for(c in a.a)b.push(c);return b};function E(){this.a=new D}E.prototype.destroy=function(){rb(this);this.a=null};function F(a,b,c,d){b=new sb(b,c,d);a.a.push(c,b)}E.prototype.sa=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.sa(),pb(this.a,b,e))}};function rb(a){for(var b=ob(a.a),c=0;c<b.length;++c)b[c].sa();a.a.a={}}function sb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
sb.prototype.sa=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function G(a){this.ya=new D;this.v=a}p("shaka.util.FakeEventTarget",G);G.prototype.addEventListener=function(a,b,c){c||this.ya.push(a,b)};G.prototype.removeEventListener=function(a,b,c){c||pb(this.ya,a,b)};
G.prototype.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return tb(this,
a)};function tb(a,b){b.currentTarget=a;for(var c=a.ya.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.v&&b.bubbles&&tb(a.v,b);return b.defaultPrevented};function ub(){G.call(this,null);this.a=new cb(3);this.c=new cb(10);this.b=0}q(ub,G);p("shaka.util.EWMABandwidthEstimator",ub);ub.prototype.sample=function(a,b){if(!(65536>b)){a=Math.max(a,50);var c=8E3*b/a,d=a/1E3;this.a.sample(d,c);this.c.sample(d,c);this.dispatchEvent(A({type:"bandwidth"}));this.b=Date.now()}};ub.prototype.getBandwidth=function(){return.5>this.a.a?5E5:Math.min(db(this.a),db(this.c))};ub.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};
ub.prototype.supportsCaching=function(){return!1};function H(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=H.prototype.destroy;return c}H.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function vb(a){return a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function wb(){this.g=new H;this.f=!1;this.a=null;this.b=[];this.c=null}function xb(a,b){if(a.f)throw Error("Cannot append to a running task!");a.b.push(b)}wb.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0;this.b.unshift(function(){});yb(this,void 0)};wb.prototype.end=function(){this.b.splice(1)};
function yb(a,b){var c=a.b[0](b),d;c?(d=c[0],a.c=c[1]):(d=Promise.resolve(),a.c=null);d.then(I(a,function(a){this.a?(this.b=[],this.c=null,zb(this)):(this.b.shift(),this.b.length?yb(this,a):(this.g.resolve(a),this.c=null))})).catch(I(a,function(a){this.b=[];this.c=null;this.a?zb(this):this.g.reject(a)}))}function zb(a){var b=Error("Task aborted.");b.type="aborted";a.g.reject(b);window.setTimeout(function(){this.a.resolve();this.a=null}.bind(a),5)};function I(a,b){return b.bind(a)};function Ab(a,b){G.call(this,b);this.a=null;this.h=a}q(Ab,G);
function Bb(a){if(!window.indexedDB)return a=Error("Persistant storage requires IndexedDB support."),a.type="storage",Promise.reject(a);if(a.a)return a=Error("A database connection is already open."),a.type="storage",Promise.reject(a);var b=new H,c=window.indexedDB.open("content_database",1);c.onupgradeneeded=I(a,function(a){this.a=a.target.result;Cb(this,"group_store",{keyPath:"group_id"});Cb(this,"stream_index_store",{keyPath:"stream_id"});a=Cb(this,"content_store",{autoIncrement:"true"});a.createIndex("segment",
["stream_id","segment_id"],{unique:!0});a.createIndex("stream","stream_id",{unique:!1})});c.onsuccess=I(a,function(a){this.a=a.target.result;b.resolve()});c.onerror=function(){b.reject(c.error)};return b}function Db(a){a.a&&(a.a.close(),a.a=null)}function Cb(a,b,c){a.a.objectStoreNames.contains(b)&&a.a.deleteObjectStore(b);return a.a.createObjectStore(b,c)}function Eb(a){return Fb(a,"content_store")}function Gb(a){return Fb(a,"stream_index_store")}function Hb(a){return Fb(a,"group_store")}
function Fb(a,b){return a.a.transaction([b],a.h).objectStore(b)}function Ib(a,b){var c=new H,d=a.get(b);d.onerror=function(){c.reject(d.error)};d.onsuccess=function(){if(d.result)c.resolve(d.result);else{var a=Error("Item not found.");a.type="storage";c.reject(a)}};return c};function Jb(){Ab.call(this,"readonly",null)}q(Jb,Ab);function Kb(a){var b=new H,c=[],d=Hb(a).openCursor();d.onerror=function(){b.reject(d.error)};d.onsuccess=function(a){(a=a.target.result)?(c.push(a.key),a.continue()):b.resolve(c)};return b}
function Lb(a,b){return Ib(Hb(a),b).then(I(a,function(a){a.session_ids=Na(a.session_ids);return a.hasOwnProperty("duration")||a.hasOwnProperty("key_system")?Promise.resolve(a):Mb(this,a.stream_ids[0]).then(function(b){a.duration=b.duration;a.key_system=b.key_system;a.license_server=b.license_server;a.with_credentials=b.with_credentials;a.distinctive_identifier=b.distinctive_identifier;a.audio_robustness=b.audio_robustness;a.video_robustness=b.video_robustness;return Promise.resolve(a)})}))}
function Mb(a,b){return Ib(Gb(a),b)}function Nb(a,b,c){return Ib(Eb(a).index("segment"),[b,c]).then(function(a){return Promise.resolve(a.content)})};function Pb(a,b,c){MediaSource.isTypeSupported(b);b=a.addSourceBuffer(b);this.v=a;this.c=b;this.l=c;this.i=new E;this.g=null;this.b=[];this.w=0;this.f=this.a=null;this.u=0;F(this.i,this.c,"updateend",this.B.bind(this))}var Qb=1/60;Pb.prototype.destroy=function(){Rb(this).catch(function(){});this.f&&this.f.destroy();this.a=this.f=null;this.g&&(Db(this.g),this.g=null);this.b=null;this.i.destroy();this.v=this.c=this.i=null};
function Sb(a,b){for(var c=a.c.buffered,d=0;d<c.length;++d){var e=c.start(d)-Qb,f=c.end(d)+Qb;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function Tb(a,b,c,d){if(a.a)return a=Error("Cannot fetch ("+a.j+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new wb;c!=a.c.timestampOffset&&(a.c.timestampOffset=c);"idb"!=b.url.b[0].P||a.g||(a.g=new Jb,xb(a.a,function(){return[Bb(this.g)]}.bind(a)));d&&xb(a.a,function(){return[Ub(this,d),this.h.bind(this)]}.bind(a));xb(a.a,function(){var a=b.a?b.a-b.b:1,c=new Vb;c.a=3;c.h=1E3*a;c.c=1E3*this.u;c.i=this.g;return[Wb(b.url,c,this.l),J.prototype.g.bind(b.url)]}.bind(a));
xb(a.a,I(a,function(a){this.l.getBandwidth();return[Ub(this,a),this.h.bind(this)]}));var e=0==a.c.buffered.length&&0==a.b.length,f=null;xb(a.a,function(){if(0==this.c.buffered.length){var a=Error("Failed to buffer segment ("+this.j+").");a.type="stream";return[Promise.reject(a)]}e&&(a=b.b,f=this.c.buffered.start(0)-a);a=Xb(this.b,b.b);0<=a?this.b.splice(a+1,0,b):this.b.push(b)}.bind(a));return Yb(a).then(function(){return Promise.resolve(f)}.bind(a))}
function Zb(a){if(a.a)return a=Error("Cannot clear ("+a.j+"): previous operation not complete."),a.type="stream",Promise.reject(a);a.a=new wb;xb(a.a,function(){var a;a:if(0==this.c.buffered.length)a=Promise.resolve();else{try{this.c.remove(0,Number.POSITIVE_INFINITY)}catch(c){a=Promise.reject(c);break a}this.b=[];a=this.f=new H}return[a,this.h.bind(this)]}.bind(a));return Yb(a)}
function $b(a,b){if(a.a){var c=Error("Cannot clearAfter ("+a.j+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.a=new wb;xb(a.a,function(){return[ac(this,b),this.h.bind(this)]}.bind(a));return Yb(a)}function Rb(a){a.a?(a=a.a,a.a?a=a.a:a.f?(a.c&&a.c(),a.a=new H,a=a.a):(a.f=!0,a=Promise.resolve())):a=Promise.resolve();return a}function Yb(a){a.a.start();return a.a.g.then(I(a,function(){this.a=null})).catch(I(a,function(a){this.a=null;return Promise.reject(a)}))}
function Ub(a,b){try{a.c.appendBuffer(b)}catch(c){return Promise.reject(c)}a.f=new H;return a.f}function ac(a,b){if(0==a.c.buffered.length)return Promise.resolve();var c=Xb(a.b,b);if(-1==c||c==a.b.length-1)return Promise.resolve();try{a.c.remove(a.b[c+1].b,Number.POSITIVE_INFINITY)}catch(d){return Promise.reject(d)}a.b=a.b.slice(0,c+1);a.f=new H;return a.f}Pb.prototype.h=function(){"open"==this.v.readyState&&this.c.abort()};Pb.prototype.B=function(){this.f.resolve();this.f=null};function bc(a){return String.fromCharCode.apply(null,a)}p("shaka.util.Uint8ArrayUtils.toString",bc);function cc(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}p("shaka.util.Uint8ArrayUtils.fromString",cc);p("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(bc(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function dc(a){return cc(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
p("shaka.util.Uint8ArrayUtils.fromBase64",dc);p("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function ec(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}p("shaka.util.Uint8ArrayUtils.toHex",ec);function Za(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function fc(){this.h=this.a="";this.i=!1;this.u=this.l=null;this.v=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}
function gc(a){var b=new fc;if(!a)return b;var c=mb(a,"keySystem");if(null!=c)b.a=c;else throw Error("'keySystem' cannot be null.");var d=mb(a,"licenseServerUrl");if(null!=d)b.h=d;else if(c)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");c=lb(a,"withCredentials","boolean");null!=c&&(b.i=c);c=nb(a,"licensePostProcessor",Function);null!=c&&(b.l=c);c=nb(a,"licensePreProcessor",Function);null!=c&&(b.u=c);c=lb(a,"distinctiveIdentifierRequired","boolean");null!=
c&&(b.g=c);c=lb(a,"persistentStateRequired","boolean");null!=c&&(b.v=c);c=mb(a,"audioRobustness");null!=c&&(b.f=c);c=mb(a,"videoRobustness");null!=c&&(b.j=c);c=nb(a,"serverCertificate",Uint8Array);null!=c&&(b.c=c);if(c=nb(a,"initData",Object)){a=nb(c,"initData",Uint8Array);if(null==a)throw Error("'initData.initData' cannot be null.");c=mb(c,"initDataType");if(null==c)throw Error("'initData.initDataType' cannot be null.");b.b.push({initData:new Uint8Array(a.buffer),initDataType:c})}return b}
function hc(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=Na(c,ic)}function ic(a,b){return a.initDataType==b.initDataType&&Za(a.initData,b.initData)};function jc(a,b){try{var c=new kc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}function lc(a){var b=this.mediaKeys;b&&b!=a&&mc(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&mc(a,this);return Promise.resolve()}
function kc(a,b){this.a=this.keySystem=a;var c=!0;"org.w3.clearkey"==a&&(this.a="webkit-org.w3.clearkey",c=!1);var d=!1,e;e=document.getElementsByTagName("video");e=e.length?e[0]:document.createElement("video");for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:g.initDataTypes,sessionTypes:["temporary"]},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var n=g.audioCapabilities[m];
n.contentType&&(l=!0,e.canPlayType(n.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(n),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)n=g.videoCapabilities[m],n.contentType&&(l=!0,e.canPlayType(n.contentType,this.a)&&(h.videoCapabilities.push(n),d=!0));l||(d=e.canPlayType("video/mp4",this.a)||e.canPlayType("video/webm",this.a));"required"==g.persistentState&&(c?(h.persistentState="required",h.sessionTypes=["persistent-license"]):d=!1);if(d){this.b=h;return}}c=
"Unsupported keySystem";if("org.w3.clearkey"==a||"com.widevine.alpha"==a)c="None of the requested configurations were supported.";c=Error(c);c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}kc.prototype.createMediaKeys=function(){var a=new nc(this.a);return Promise.resolve(a)};kc.prototype.getConfiguration=function(){return this.b};function nc(a){this.g=a;this.b=null;this.a=new E;this.c=[];this.f={}}
function mc(a,b){a.b=b;rb(a.a);b&&(F(a.a,b,"webkitneedkey",a.Rb.bind(a)),F(a.a,b,"webkitkeymessage",a.Qb.bind(a)),F(a.a,b,"webkitkeyadded",a.Ob.bind(a)),F(a.a,b,"webkitkeyerror",a.Pb.bind(a)))}k=nc.prototype;k.createSession=function(a){var b=a||"temporary";if("temporary"!=b&&"persistent-license"!=b)throw new TypeError("Session type "+a+" is unsupported on this platform.");a=this.b||document.createElement("video");a.src||(a.src="about:blank");b=new oc(a,this.g,b);this.c.push(b);return b};
k.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};k.Rb=function(a){a=A({type:"encrypted",initDataType:"webm",initData:a.initData});this.b.dispatchEvent(a)};k.Qb=function(a){var b=pc(this,a.sessionId);b&&(a=A({type:"message",messageType:void 0==b.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message}),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a))};
k.Ob=function(a){if(a=pc(this,a.sessionId))qc(a,"usable"),a.a&&a.a.resolve(),a.a=null};
k.Pb=function(a){var b=pc(this,a.sessionId);if(b){var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45==a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?qc(b,"output-restricted"):1==c?qc(b,"expired"):qc(b,"internal-error"))}};
function pc(a,b){var c=a.f[b];return c?c:(c=a.c.shift())?(c.sessionId=b,a.f[b]=c):null}function oc(a,b,c){G.call(this,null);this.f=a;this.h=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new H;this.keyStatuses=new rc}q(oc,G);
function sc(a,b,c){if(a.h)return Promise.reject(Error("The session is already initialized."));a.h=!0;var d;try{if("persistent-license"==a.g)if(c)d=cc("LOAD_SESSION|"+c);else{var e=new Uint8Array(b);d=cc("PERSISTENT|"+bc(e))}else d=new Uint8Array(b)}catch(f){return Promise.reject(f)}a.b=new H;try{a.f.webkitGenerateKeyRequest(a.c,d)}catch(g){if("InvalidStateError"!=g.name)return a.b=null,Promise.reject(g);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,d)}catch(a){this.b.reject(a),
this.b=null}}.bind(a),10)}return a.b}k=oc.prototype;k.Qa=function(a,b){if(this.a)this.a.then(this.Qa.bind(this,a,b)).catch(this.Qa.bind(this,a,b));else{this.a=a;var c,d;"webkit-org.w3.clearkey"==this.c?(c=bc(new Uint8Array(b)),d=JSON.parse(c),"oct"!=d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),c=dc(d.keys[0].k),d=dc(d.keys[0].kid)):(c=new Uint8Array(b),d=null);try{this.f.webkitAddKey(this.c,c,d,this.sessionId)}catch(e){this.a.reject(e),this.a=null}}};
function qc(a,b){a.keyStatuses.Ma(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}k.generateRequest=function(a,b){return sc(this,b,null)};k.load=function(a){return"persistent-license"==this.g?sc(this,null,a):Promise.reject(Error("Not a persistent session."))};k.update=function(a){var b=new H;this.Qa(b,a);return b};
k.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}this.closed.resolve();return this.closed};k.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};function tc(a){this.b=a;this.a=0}
tc.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function rc(){this.size=0;this.a=void 0}var uc;k=rc.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};k.entries=function(){var a=uc,b=[];this.a&&b.push([a,this.a]);return new tc(b)};k.forEach=function(a){this.a&&a(this.a,uc)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=uc;return this.a&&Za(new Uint8Array(a),b)?!0:!1};
k.keys=function(){var a=uc,b=[];this.a&&b.push(a);return new tc(b)};k.values=function(){var a=[];this.a&&a.push(this.a);return new tc(a)};function vc(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Pa(new DataView(a.buffer));try{for(;Ra(a);){var b=a.a,c=y(a),d=y(a);1==c?c=Ta(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)z(a,c-(a.a-b));else{var e=Sa(a);if(1<e)z(a,c-(a.a-b));else{z(a,3);var f=ec(Ua(a)),g=[];if(0<e)for(var h=y(a),l=0;l<h;++l){var m=ec(Ua(a));g.push(m)}var n=y(a);z(a,n);this.cencKeyIds.push.apply(this.cencKeyIds,g);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&z(a,c-(a.a-b))}}}}catch(t){}};function wc(a,b){try{var c=new xc(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}}
function xc(a,b){this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"]},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];if(l.contentType){var g=!0,m=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.audioCapabilities.push(l),c=!0)}}if(e.videoCapabilities)for(h=
0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,m=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4"));"required"==e.persistentState&&(f.persistentState="required",f.sessionTypes=["persistent-license"]);if(c){this.a=f;return}}c=Error("Unsupported keySystem");c.name="NotSupportedError";c.code=DOMException.NOT_SUPPORTED_ERR;throw c;}
xc.prototype.createMediaKeys=function(){var a=new yc(this.keySystem);return Promise.resolve(a)};xc.prototype.getConfiguration=function(){return this.a};function zc(a){var b=this.mediaKeys;b&&b!=a&&Ac(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?Ac(a,this):Promise.resolve()}function yc(a){this.a=new MSMediaKeys(a);this.b=new E}yc.prototype.createSession=function(a){if("temporary"!=(a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new Bc(this.a)};
yc.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))};function Ac(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener("loadedmetadata",c)}rb(a.b);if(!b)return Promise.resolve();F(a.b,b,"msneedkey",Cc);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener("loadedmetadata",c),Promise.resolve()}catch(e){return Promise.reject(e)}}
function Bc(a){G.call(this,null);this.c=null;this.g=a;this.b=this.a=null;this.f=new E;this.sessionId="";this.expiration=NaN;this.closed=new H;this.keyStatuses=new Dc}q(Bc,G);k=Bc.prototype;k.generateRequest=function(a,b){this.a=new H;try{this.c=this.g.createSession("video/mp4",b),F(this.f,this.c,"mskeymessage",this.Db.bind(this)),F(this.f,this.c,"mskeyadded",this.Bb.bind(this)),F(this.f,this.c,"mskeyerror",this.Cb.bind(this)),Ec(this,"status-pending")}catch(c){this.a.reject(c)}return this.a};
k.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))};k.update=function(a){this.b=new H;try{this.c.update(a)}catch(b){this.b.reject(b)}return this.b};k.close=function(){try{this.c.close(),this.closed.resolve(),rb(this.f)}catch(a){this.closed.reject(a)}return this.closed};k.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))};
function Cc(a){var b=a.initData;if(b){var c=new vc(b);if(1>=c.a.length)a=b;else{var d=[];for(a=0;a<c.a.length;a++)d.push(b.subarray(c.a[a].start,c.a[a].end+1));b=Na(d,Fc);for(a=c=0;a<b.length;a++)c+=b[a].length;c=new Uint8Array(c);for(a=d=0;a<b.length;a++)c.set(b[a],d),d+=b[a].length;a=c}}else a=b;a=A({type:"encrypted",initDataType:"cenc",initData:a});this.dispatchEvent(a)}function Fc(a,b){return Za(a,b)}
k.Db=function(a){this.a&&(this.a.resolve(),this.a=null);a=A({type:"message",messageType:void 0==this.keyStatuses.Fa()?"licenserequest":"licenserenewal",message:a.message.buffer});this.dispatchEvent(a)};k.Bb=function(){this.a?(this.a.resolve(),this.a=null):this.b&&(Ec(this,"usable"),this.b.resolve(),this.b=null)};
k.Cb=function(){var a=Error("EME v20140218 key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Ec(this,"output-not-allowed");default:Ec(this,"internal-error")}};function Ec(a,b){a.keyStatuses.Ma(b);var c=A({type:"keystatuseschange"});a.dispatchEvent(c)}function Gc(a){this.b=a;this.a=0}
Gc.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};function Dc(){this.size=0;this.a=void 0}var Hc;k=Dc.prototype;k.Ma=function(a){this.size=void 0==a?0:1;this.a=a};k.Fa=function(){return this.a};k.entries=function(){var a=Hc,b=[];this.a&&b.push([a,this.a]);return new Gc(b)};k.forEach=function(a){this.a&&a(this.a,Hc)};k.get=function(a){if(this.has(a))return this.a};k.has=function(a){var b=Hc;return this.a&&Za(new Uint8Array(a),b)?!0:!1};
k.keys=function(){var a=Hc,b=[];this.a&&b.push(a);return new Gc(b)};k.values=function(){var a=[];this.a&&a.push(this.a);return new Gc(a)};function Ic(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(uc=new Uint8Array([0]),Navigator.prototype.requestMediaKeySystemAccess=jc,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=lc,window.MediaKeys=nc,window.MediaKeySystemAccess=kc):window.MSMediaKeys?(Hc=new Uint8Array([0]),delete HTMLMediaElement.prototype.mediaKeys,
HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=zc,window.MediaKeys=yc,window.MediaKeySystemAccess=xc,Navigator.prototype.requestMediaKeySystemAccess=wc):(Navigator.prototype.requestMediaKeySystemAccess=ya,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=za,window.MediaKeys=Aa,window.MediaKeySystemAccess=Ba))}p("shaka.polyfill.MediaKeys.install",Ic);p("shaka.polyfill.installAll",function(){ta();wa();La();Da();Ic()});var Jc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function K(a){var b;a instanceof K?(Kc(this,a.P),this.ca=a.ca,this.S=a.S,Lc(this,a.ia),this.O=a.O,Mc(this,a.a.clone()),this.aa=a.aa):a&&(b=String(a).match(Jc))?(Kc(this,b[1]||"",!0),this.ca=Nc(b[2]||""),this.S=Nc(b[3]||"",!0),Lc(this,b[4]),this.O=Nc(b[5]||"",!0),Mc(this,b[6]||"",!0),this.aa=Nc(b[7]||"")):this.a=new Oc(null)}k=K.prototype;k.P="";k.ca="";k.S="";k.ia=null;k.O="";k.aa="";
k.toString=function(){var a=[],b=this.P;b&&a.push(Pc(b,Qc,!0),":");if(b=this.S){a.push("//");var c=this.ca;c&&a.push(Pc(c,Qc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.ia;null!=b&&a.push(":",String(b))}if(b=this.O)this.S&&"/"!=b.charAt(0)&&a.push("/"),a.push(Pc(b,"/"==b.charAt(0)?Sc:Tc,!0));(b=this.a.toString())&&a.push("?",b);(b=this.aa)&&a.push("#",Pc(b,Uc));return a.join("")};
k.resolve=function(a){var b=this.clone();"data"===b.P&&(b=new K);var c=!!a.P;c?Kc(b,a.P):c=!!a.ca;c?b.ca=a.ca:c=!!a.S;c?b.S=a.S:c=null!=a.ia;var d=a.O;if(c)Lc(b,a.ia);else if(c=!!a.O){if("/"!=d.charAt(0))if(this.S&&!this.O)d="/"+d;else{var e=b.O.lastIndexOf("/");-1!=e&&(d=b.O.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],g=0;g<d.length;){var h=d[g++];"."==h?e&&g==d.length&&f.push(""):".."==h?((1<f.length||
1==f.length&&""!=f[0])&&f.pop(),e&&g==d.length&&f.push("")):(f.push(h),e=!0)}d=f.join("/")}}c?b.O=d:c=""!==a.a.toString();c?Mc(b,a.a.clone()):c=!!a.aa;c&&(b.aa=a.aa);return b};k.clone=function(){return new K(this)};function Kc(a,b,c){a.P=c?Nc(b,!0):b;a.P&&(a.P=a.P.replace(/:$/,""))}function Lc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.ia=b}else a.ia=null}function Mc(a,b,c){b instanceof Oc?a.a=b:(c||(b=Pc(b,Vc)),a.a=new Oc(b))}
function Nc(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function Pc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,Wc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Wc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Qc=/[#\/\?@]/g,Tc=/[\#\?:]/g,Sc=/[\#\?]/g,Vc=/[\#\?@]/g,Uc=/#/g;function Oc(a){this.b=a||null}Oc.prototype.a=null;Oc.prototype.c=null;
function Xc(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),g=null,h=null;0<=f?(g=d[e].substring(0,f),h=d[e].substring(f+1)):g=d[e];g=decodeURIComponent(g.replace(/\+/g," "));h=h||"";Xc(a,g,decodeURIComponent(h.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
Oc.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};Oc.prototype.clone=function(){var a=new Oc;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function Yc(){this.id=this.url=null;this.type="static";this.b=this.j=this.s=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}function Zc(){this.g=this.f=this.c=this.s=this.a=this.start=this.id=null;this.b=[]}function $c(){this.i=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.c=!1;this.h=this.g=this.f=this.s=null;this.j=[];this.a=[]}function ad(){this.value=null}function bd(){this.contentType=this.lang=this.id=null}
function cd(){this.a=this.b=this.g=this.s=this.h=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function dd(){this.b=this.a=this.c=this.f=null}function ed(){this.parsedPssh=this.psshBox=null}function fd(){this.url=null}function gd(){this.url=null}function hd(){this.s=null;this.g=1;this.c=this.b=this.a=this.f=null}hd.prototype.clone=function(){var a=new hd;a.s=id(this.s);a.g=this.g;a.f=this.f;a.a=L(this.a);a.b=L(this.b);a.c=L(this.c);return a};
function jd(){this.a=this.url=null}jd.prototype.clone=function(){var a=new jd;a.url=id(this.url);a.a=L(this.a);return a};function kd(){this.a=this.url=null}kd.prototype.clone=function(){var a=new kd;a.url=id(this.url);a.a=L(this.a);return a};function ld(){this.s=null;this.f=1;this.b=this.g=null;this.i=1;this.h=null;this.a=[];this.c=null}ld.prototype.clone=function(){var a=new ld;a.s=id(this.s);a.f=this.f;a.g=this.g;a.b=this.b;a.i=this.i;a.h=L(this.h);a.a=id(this.a)||[];a.c=L(this.c);return a};
function md(){this.a=this.b=null}md.prototype.clone=function(){var a=new md;a.b=id(this.b);a.a=L(this.a);return a};function nd(){this.a=1;this.b=this.j=null;this.c=1;this.v=!1;this.f=this.h=this.g=this.i=null}nd.prototype.clone=function(){var a=new nd;a.a=this.a;a.j=this.j;a.b=this.b;a.c=this.c;a.v=this.v;a.i=this.i;a.g=this.g;a.h=this.h;a.f=L(this.f);return a};function od(){this.a=[]}od.prototype.clone=function(){var a=new od;a.a=id(this.a)||[];return a};function pd(){this.c=this.a=this.b=null}
pd.prototype.clone=function(){var a=new pd;a.b=this.b;a.a=this.a;a.c=this.c;return a};function qd(a,b){this.na=a;this.end=b}qd.prototype.clone=function(){return new qd(this.na,this.end)};Yc.TAG_NAME="MPD";Zc.TAG_NAME="Period";$c.TAG_NAME="AdaptationSet";ad.TAG_NAME="Role";bd.TAG_NAME="ContentComponent";cd.TAG_NAME="Representation";dd.TAG_NAME="ContentProtection";ed.TAG_NAME="cenc:pssh";fd.TAG_NAME="BaseURL";gd.TAG_NAME="Location";hd.TAG_NAME="SegmentBase";jd.TAG_NAME="RepresentationIndex";
kd.TAG_NAME="Initialization";ld.TAG_NAME="SegmentList";md.TAG_NAME="SegmentURL";nd.TAG_NAME="SegmentTemplate";od.TAG_NAME="SegmentTimeline";pd.TAG_NAME="S";
Yc.prototype.parse=function(a,b){this.url=a.s;this.id=M(b,"id",N);this.type=M(b,"type",N)||"static";this.b=M(b,"mediaPresentationDuration",rd);this.h=M(b,"minBufferTime",rd,this.h);this.g=M(b,"minimumUpdatePeriod",rd,this.g);this.c=M(b,"availabilityStartTime",sd,this.c);this.f=M(b,"timeShiftBufferDepth",rd,this.f);this.i=M(b,"suggestedPresentationDelay",rd,this.i);var c=a.s,d=O(this,b,fd);this.s=td(c,d);if(d=P(this,b,gd))this.j=ud(c,d.url);this.a=O(this,b,Zc)};
Zc.prototype.parse=function(a,b){this.id=M(b,"id",N);this.start=M(b,"start",rd);this.a=M(b,"duration",rd);var c=O(this,b,fd);this.s=td(a.s,c);this.c=P(this,b,hd);this.f=P(this,b,ld);this.g=P(this,b,nd);this.b=O(this,b,$c);vd(this)};function vd(a){for(var b=[],c=0;c<a.b.length;++c){var d=a.b[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.b.length;++c)if(d=a.b[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
$c.prototype.parse=function(a,b){var c=P(this,b,bd)||{},d=P(this,b,ad);this.id=M(b,"id",N);this.group=M(b,"group",Q);this.lang=M(b,"lang",N,c.lang);this.contentType=M(b,"contentType",N,c.contentType);this.width=M(b,"width",R);this.height=M(b,"height",R);this.b=M(b,"mimeType",N);this.i=M(b,"codecs",N);this.c=d&&"main"==d.value;this.lang&&(this.lang=fb(this.lang));c=O(this,b,fd);this.s=td(a.s,c);this.j=O(this,b,dd);!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]);this.f=a.c?wd(this,
b,a.c):P(this,b,hd);this.g=a.f?wd(this,b,a.f):P(this,b,ld);this.h=a.g?wd(this,b,a.g):P(this,b,nd);this.a=O(this,b,cd);!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))};ad.prototype.parse=function(a,b){this.value=M(b,"value",N)};bd.prototype.parse=function(a,b){this.id=M(b,"id",N);this.lang=M(b,"lang",N);this.contentType=M(b,"contentType",N);this.lang&&(this.lang=fb(this.lang))};
cd.prototype.parse=function(a,b){this.id=M(b,"id",N);this.bandwidth=M(b,"bandwidth",R);this.width=M(b,"width",R,a.width);this.height=M(b,"height",R,a.height);this.f=M(b,"mimeType",N,a.b);this.h=M(b,"codecs",N,a.i);this.lang=a.lang;var c=O(this,b,fd);this.s=td(a.s,c);this.c=O(this,b,dd);this.g=a.f?wd(this,b,a.f):P(this,b,hd);this.b=a.g?wd(this,b,a.g):P(this,b,ld);this.a=a.h?wd(this,b,a.h):P(this,b,nd);this.c=this.c.concat(a.j)};
dd.prototype.parse=function(a,b){this.f=b;this.c=M(b,"schemeIdUri",N);var c=M(b,"cenc:default_KID",N);c&&(this.b=c.replace(/[-]/g,""));this.a=P(this,b,ed)};ed.prototype.parse=function(a,b){var c=xd(b);if(c){this.psshBox=dc(c);try{this.parsedPssh=new vc(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};fd.prototype.parse=function(a,b){this.url=xd(b)};gd.prototype.parse=function(a,b){this.url=xd(b)};
hd.prototype.parse=function(a,b){this.s=a.s||this.s;this.g=M(b,"timescale",R,this.g);this.f=M(b,"presentationTimeOffset",Q,this.f);this.a=M(b,"indexRange",yd,this.a);this.b=P(this,b,jd)||this.b;this.c=P(this,b,kd)||this.c};jd.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=ud(a.s,c);this.a=M(b,"range",yd,L(a.a))};kd.prototype.parse=function(a,b){var c=M(b,"sourceURL",N);this.url=ud(a.s,c);this.a=M(b,"range",yd)};
ld.prototype.parse=function(a,b){this.s=a.s||this.s;this.f=M(b,"timescale",R,this.f);this.g=M(b,"presentationTimeOffset",Q,this.g);this.b=M(b,"duration",R,this.b);var c=M(b,"startNumber",Q,this.i);null!=c&&(this.i=0<c?c:1);this.h=P(this,b,kd)||this.h;this.a=(c=O(this,b,md))&&0<c.length?c:this.a;this.c=P(this,b,od)||this.c};md.prototype.parse=function(a,b){var c=M(b,"media",N);this.b=ud(a.s,c);this.a=M(b,"mediaRange",yd)};
nd.prototype.parse=function(a,b){this.a=M(b,"timescale",R,this.a);this.j=M(b,"presentationTimeOffset",Q,this.j);this.b=M(b,"duration",R,this.b);var c=M(b,"startNumber",Q,this.c);null!=c&&(0<c?this.c=c:(this.c=1,this.v=!0));this.i=M(b,"media",N,this.i);this.g=M(b,"index",N,this.g);this.h=M(b,"initialization",N,this.h);this.f=P(this,b,od)||this.f};od.prototype.parse=function(a,b){this.a=O(this,b,pd)};pd.prototype.parse=function(a,b){this.b=M(b,"t",Q);this.a=M(b,"d",Q);this.c=M(b,"r",zd)};
function td(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new K(e)):(e=ud(a.slice(0,1),e),c.push(e[0]))}return c}function ud(a,b){if(!b)return a;var c=new K(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function wd(a,b,c){var d=L(c);(b=Ad(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function P(a,b,c){var d=null;if(b=Ad(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Ad(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function O(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function xd(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function id(a){return a?a.map(function(a){return a.clone()}):null}function L(a){return a?a.clone():null}
function M(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function sd(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function rd(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=Q(b[1]);c&&(a+=31536E3*c);(c=Q(b[2]))&&(a+=2592E3*c);(c=Q(b[3]))&&(a+=86400*c);(c=Q(b[4]))&&(a+=3600*c);(c=Q(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function yd(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=Q(b[1]);if(null==a)return null;b=Q(b[2]);return null==b?null:new qd(a,b)}function zd(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function R(a){a=window.parseInt(a,10);return 0<a?a:null}function Q(a){a=window.parseInt(a,10);return 0<=a?a:null}function N(a){return a};function Bd(a,b){this.url=a;this.b=b||new Vb;this.g=this.i=this.h=0;this.a=null;this.c=new H;this.f=null}function Vb(){this.body=null;this.a=1;this.h=1E3;this.c=0;this.method="GET";this.f="arraybuffer";this.b={};this.g=this.j=!1;this.i=null}function Cd(a){Dd(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}function Dd(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}k=Bd.prototype;
k.rb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.f&&(b=cc(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Cd(this);return b}if(0==this.url.lastIndexOf("idb:",0))return Ed(this);this.h++;this.i=Date.now();this.g||
(this.g=this.b.h);this.a=new XMLHttpRequest;a=this.url;if(this.f&&!this.f.supportsCaching()||this.b.g)a=new K(a),Xc(a.a,"_",Date.now()),a=a.toString();this.a.open(this.b.method,a,!0);this.a.responseType=this.b.f;this.a.timeout=this.b.c;this.a.withCredentials=this.b.j;this.a.onload=this.zb.bind(this);this.b.g&&(this.a.onreadystatechange=this.Gb.bind(this));this.a.onerror=this.Xb.bind(this);this.a.ontimeout=this.Lb.bind(this);for(b in this.b.b)this.a.setRequestHeader(b,this.b.b[b]);this.a.send(this.b.body);
return this.c};function Ed(a){var b=a.url.split("/");return Nb(a.b.i,parseInt(b[2],10),parseInt(b[3],10)).then(I(a,function(a){var b=JSON.parse(JSON.stringify(new XMLHttpRequest));b.response=a;a=this.c;a.resolve(b);Cd(this);return a})).catch(I(a,function(a){Cd(this);return Promise.reject(a)}))}function Fd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.ac=a.a;return b}
k.zb=function(a){this.f&&this.f.sample(Date.now()-this.i,a.loaded);200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Cd(this)):this.h<this.b.a?Gd(this):(a=Fd(this,"HTTP error.","net"),this.c.reject(a),Cd(this))};k.Gb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Oa=a-Date.now())}};k.Xb=function(){var a=Fd(this,"Network failure.","net");this.c.reject(a);Cd(this)};
k.Lb=function(){if(this.h<this.b.a)Gd(this);else{var a=Fd(this,"Request timed out.","net");this.c.reject(a);Cd(this)}};function Gd(a){Dd(a);window.setTimeout(a.rb.bind(a),a.g*(1+.5*(2*Math.random()-1)));a.g*=2};function J(a,b,c,d){this.b=b;this.f=c||0;this.h=null!=d?d:null;this.c=this.a=null;this.i=a}function Hd(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}function Wb(a,b,c){if(a.a)return a.a;b=b||new Vb;if(a.f||a.h)b.b.Range="bytes="+(a.f+"-"+(null!=a.h?a.h:""));a.a=Id(a,0,b,c);return a.a}J.prototype.g=function(){if(this.c){this.a=null;var a=this.c;if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){a.a.abort();var b=Fd(a,"Request aborted.","aborted");a.c.reject(b);Cd(a)}this.c=null}};
function Id(a,b,c,d){var e=a.b[b].toString();a.i&&(e=a.i(e,c.b)||e);a.c=new Bd(e,c);d&&(a.c.f=d);e=a.c.rb().then(I(a,function(a){this.c=this.a=null;return Promise.resolve(a.response)}));return e=e.catch(I(a,function(a){if(this.a&&b+1<this.b.length)return this.a=Id(this,b+1,c,d);this.a=this.c=null;return Promise.reject(a)}))}J.prototype.clone=function(){return new J(this.i,this.b.map(function(a){return a.clone()}),this.f,this.h)};J.prototype.toString=function(){return this.b[0].toString()};function Jd(a,b){this.a=new Vb;this.a.f="text";this.a.a=3;this.a.c=1E3*(null!=b?b:0);this.a.g=!0;this.b=a}function Kd(a){var b=a.b;return Wb(b,a.a).then(function(a){var d;d=b.b;d=(a=(new DOMParser).parseFromString(a,"text/xml"))?P({s:d},a,Yc):null;if(d)return Promise.resolve(d);d=Error("MPD parse failure.");d.type="dash";return Promise.reject(d)})};function Ld(a,b,c,d){for(var e=b.a,f=[],g=0;g<d;++g){var h=g+c,l=(h-1)*e.b,m=l/e.a,n=(l+e.b)/e.a,h=Md(a,b,e.v?h-1:h,l);if(!h)return null;f.push(new Nd(m,n,h))}return f}function Md(a,b,c,d){if(!b.a)return null;var e=b.a.i;if(!e)return b.s?new J(a,b.s,0,null):null;c=Od(e,b.id,c,b.bandwidth,d);if(!c)return null;b=Hd(b.s,c);return new J(a,b,0,null)}
function Od(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new K(a)}catch(g){if(g instanceof URIError)return null;throw g;}}
function Pd(a,b,c){var d=0;b*=c;a=a.a;c=[];for(var e=0;e<a.length&&a[e].a;++e){var f=a[e].b,f=null!=f?f:d,g=a[e].c||0;0>g&&(g=a[e].a,g=e+1===a.length?Math.ceil((a[0].b+b-f)/g)-1:Math.ceil((a[e+1].b-f)/g)-1);0<c.length&&f!=d&&(c[c.length-1].end=f);for(var h=0;h<=g;++h)d=f+a[e].a,c.push({start:f,end:d}),f=d}return c};function Qd(a,b){this.a=a;this.b=b||null}Qd.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null);this.b=null};Qd.prototype.create=function(){return this.a?Wb(this.a):Promise.resolve(this.b)};function Nd(a,b,c){this.b=a;this.a=b;this.url=c}function Rd(a,b,c){return new Nd(b,c,a.url)}function Xb(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.b&&(null==d.a||b<d.a))return c}return-1}function Sd(a,b){return a.map(function(a){return Rd(a,a.b+b,null!=a.a?a.a+b:null)})};function Td(){}
Td.prototype.parse=function(a,b,c,d){var e=null;try{a:{var f=[],g=new Pa(a),h=y(g);if(1936286840!=y(g))e=null;else{1==h&&(h=Ta(g));var l=Sa(g);z(g,3);z(g,4);var m=y(g);if(0==m)e=null;else{var n,t;0==l?(n=y(g),t=y(g)):(n=Ta(g),t=Ta(g));z(g,2);var C=g.b.getUint16(g.a,g.c);g.a+=2;a=n;b=b+h+t;for(h=0;h<C;h++){var u=y(g);t=(u&2147483648)>>>31;var l=u&2147483647,v=y(g);y(g);if(1==t){e=null;break a}var va=new J(d,c,b,b+l-1);f.push(new Nd(a/m,(a+v)/m,va));a+=v;b+=l}e=f}}}}catch(Ob){if(!(Ob instanceof RangeError))throw Ob;
}return e};function S(a){this.o=a;this.i=0}S.prototype.destroy=function(){this.o=null};k=S.prototype;k.length=function(){return this.o.length};function T(a){if(0==a.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.o[0]}k.A=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]};
k.get=function(a){if(0>a||a>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[a]};k.la=function(a){a=Xb(this.o,a);return 0<=a?this.o[a]:null};k.Ha=function(a){Ud(this,a);return!0};
function Ud(a,b){a.i!=b.i&&(b=new S(Sd(b.o,a.i-b.i)));if(0==a.length())a.o=b.o.slice(0);else if(0!=b.length()&&null!=a.A().a&&!(null!=b.A().a&&b.A().a<a.A().a)){if(a.A().a<=T(b).b)var c=Rd(a.A(),a.A().b,T(b).b),c=a.o.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.o.length&&!(a.o[d].a>=T(b).b);++d);a.o[d].b<T(b).b?(c=Rd(a.o[d],a.o[d].b,T(b).b),c=a.o.slice(0,d).concat([c])):(T(a).b>T(b).b||T(b),c=a.o.slice(0,d))}a.o=c.concat(b.o)}}
k.ka=function(a){var b=a-this.i;if(0==b)return 0;this.o=Sd(this.o,b);this.i=a;return b};k.Ea=function(){return 0<this.length()?{start:T(this).b,end:this.A().a}:{start:0,end:0}};function U(a,b,c,d){S.call(this,a);this.g=b;this.w=c;this.f=d;this.h=this.g.b||this.g.a.reduce(function(a,b){return null==b.a?NaN:a+b.a},0)||0;this.a=this.l=this.c=null;Vd(this)}q(U,S);U.prototype.destroy=function(){this.w=this.g=null;S.prototype.destroy.call(this)};U.prototype.la=function(a){Wd(this,x()/1E3);return S.prototype.la.call(this,a)};U.prototype.Ha=function(a){if(!(a instanceof U))return!1;Ud(this,a);this.h=Math.max(this.h,a.h);null==this.c?(this.f=a.f,Vd(this)):Xd(this);return!0};
function Vd(a){Xd(a);if(0!=a.length()){a.length();var b=null!=a.A().a?a.A().a:a.A().b;if(a.g.c>a.f)a.c=b;else{var c=a.f-(a.g.c+a.w.start);0>c?a.c=b:c<Math.max(a.A().b,a.A().a||0)?(a.A(),a.c=b):a.c=c}a.l=a.A().b;a.a=T(a).b}}U.prototype.ka=function(a){a=S.prototype.ka.call(this,a);Math.min.apply(null,this.o.filter(function(a){return null!=a.a}).map(function(a){return a.a-a.b}));null!=this.c&&(this.l+=a,this.a+=a,this.c+=a);return a};U.prototype.Ea=function(){return Yd(this,x()/1E3)};
function Yd(a,b){Wd(a,b);if(null==a.c||null==a.l||null==a.a)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.h&&(c=a.h);var d=b-a.f,e=a.c+d;null!=a.g.f&&(e=e-a.a-a.g.f,0<e&&(a.a+=e));a.a=Math.min(a.a,c);d=a.l+d;if(d<a.a)return{start:a.a,end:a.a};d=0<a.length()?null!=a.A().a?Math.min(d,a.A().a):d:a.a;d=Math.max(d,a.a);d=Math.min(d,c);return{start:a.a,end:d}}
function Wd(a,b){Xd(a);if(null!=a.g.f)if(null==a.c)a.length();else{for(var c=a.c+(b-a.f),d=0,e=0;e<a.o.length;++e){var f=null;e<a.o.length-1?f=a.o[e+1].a:(f=a.o[e],f=null!=f.a?f.a+(f.a-f.b):null);if(null!=f&&f<c-a.g.f)++d;else break}0<d&&a.o.splice(0,d)}}function Xd(a){if(a.h){for(var b=0,c=a.o.length-1;0<=c;--c)if(a.o[c].b>a.h)++b;else break;0<b&&a.o.splice(-b)}};function Zd(a,b,c,d,e){var f=1,g=0,h;if(a.c>d)h=null;else{var l=a.i||0,m=a.f||0;h=c.a;h=h.b/h.a;var n=d-(a.c+b.start);0>n?h=null:(m=n-2*h-m,0>m&&(m=0),m=Math.ceil(m/h)*h,n-=h,0>n?h=null:(l=Math.floor(n/h)*h-l,0>l&&(l=0),l=Math.floor(l/h)*h,h={Za:m/h+1,current:(l>=m?l:m)/h+1}))}h&&(f=h.Za,g=h.current-h.Za+1);f=Ld(e,c,f,g);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;U.call(this,f,a,b,d);this.u=c;this.v=this.b=0<this.length()?a.c+b.start+this.A().a:null;this.j=
h?h.current+1:null;this.B=e}q(Zd,U);Zd.prototype.destroy=function(){this.B=this.u=null;U.prototype.destroy.call(this)};Zd.prototype.la=function(a){var b=x()/1E3;$d(this,b);Wd(this,b);return S.prototype.la.call(this,a)};Zd.prototype.Ha=function(a){if(null!=this.b||!(a instanceof Zd)||null==a.b)return!1;this.b=a.b;this.v=a.v;this.j=a.j;this.f=a.f;this.h=a.h;Ud(this,a);$d(this,x()/1E3);Vd(this);return!0};Zd.prototype.ka=function(a){a=U.prototype.ka.call(this,a);null!=this.b&&(this.b+=a,this.v+=a);return a};
Zd.prototype.Ea=function(){var a=x()/1E3;$d(this,a);return Yd(this,a)};function $d(a,b){if(null!=a.b&&null!=a.v&&null!=a.j){var c=a.u.a,c=c.b/c.a,d=Math.floor((a.v+(b-a.f)-a.b)/c);if(0!=d){var e=Ld(a.B,a.u,a.j,d);Array.prototype.push.apply(a.o,Sd(e,a.i));a.b+=d*c;a.j+=d}}};function ae(a,b,c,d,e){this.f=a;this.b=b;this.c=c;this.h=d;this.a=null;this.g=e}ae.prototype.destroy=function(){this.g=this.c=this.b=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
ae.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new Zd(this.f,this.b,this.c,this.h,this.g)}catch(a){return Promise.reject(a)}else{var b;b=this.c.a;var c=Math.ceil(this.b.a/(b.b/b.a));b.c>c?b=null:(b=Ld(this.g,this.c,b.c,c-(b.c-1)))?(0<b.length&&(c=b[b.length-1],b[b.length-1]=Rd(c,c.b,this.b.a)),b=new S(b)):b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function le(a,b,c,d,e){this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}le.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
le.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.b,b=[];a.c&&(b=Pd(a.c,a.f||1,this.b.a||0));var c=0;a.b&&a.i?c=(a.i-1)*a.b:0<b.length&&(c=b[0].start-(a.g||0));var d=a.a.length;0<b.length&&b.length!=a.a.length&&(d=Math.min(b.length,a.a.length));for(var e=[],f=0;f<d;++f){var g=a.a[f],h=c/a.f,l=null,m=null;a.b?(l=c+a.b,m=l/a.f):0<b.length?(l=b[f].end-(a.g||0),m=l/a.f):(m=h+this.b.a,l=m*a.f);var c=l,l=0,n=null;g.a&&(l=g.a.na,n=g.a.end);e.push(new Nd(h,m,new J(this.f,
g.b,l,n)))}"dynamic"==this.c.type?this.a=new U(e,this.c,this.b,this.h):this.a=new S(e);return Promise.resolve(this.a)};function me(a,b,c,d,e){this.b=a;this.c=b;this.f=c;this.h=d;this.a=null;this.g=e}me.prototype.destroy=function(){this.g=this.f=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
me.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.f.a,b=Pd(a.f,a.a||1,this.c.a||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=e/a.a,g=b[d].end/a.a,e=Md(this.g,this.f,d+a.c,e);if(!e)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var h=(a.j||0)/a.a;c.push(new Nd(f-h,g-h,e))}"dynamic"==this.b.type?this.a=new U(c,this.b,this.c,this.h):this.a=new S(c);return Promise.resolve(this.a)};function ne(a){this.b=a;this.a=null}ne.prototype.destroy=function(){this.b=null;this.a&&(this.a.destroy(),this.a=null)};ne.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=[],b=0;b<this.b.length;++b){var c=this.b[b];a.push(new Nd(c.start_time,c.end_time,new J(null,[new K(c.url)],c.start_byte,null)))}this.b=null;this.a=new S(a);return Promise.resolve(this.a)};function oe(){this.C=pe++;this.id=this.D=this.H=null;this.c=0;this.height=this.width=this.bandwidth=null;this.b=this.a="";this.f=[];this.N=!1;this.J=!0}var pe=0;oe.prototype.destroy=function(){this.H&&(this.H.destroy(),this.H=null);this.D&&(this.D.destroy(),this.D=null)};function qe(a){var b=a.a||"";a.b&&(b+='; codecs="'+a.b+'"');return b}function re(){this.C=se++;this.id=null;this.contentType=this.lang="";this.b=!1;this.m=[];this.a=[]}var se=0;
re.prototype.destroy=function(){for(var a=0;a<this.m.length;++a)this.m[a].destroy();this.a=this.m=null};function te(a){for(var b=[],c=0;c<a.a.length;++c){var d=new ue;d.id=a.C;d.a=a.a[c];d.contentType=a.contentType;d.b=a.m.length?qe(a.m[0]):"";b.push(d)}return b}function ve(){this.id=null;this.start=0;this.b=null;this.a=[]}ve.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function we(){this.b=!1;this.h=this.g=this.f=null;this.c=0;this.a=[]}
we.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function ue(){this.id=0;this.a=null;this.b=this.contentType=""};function xe(a,b,c,d,e){G.call(this,a);this.c=b;this.a=new Pb(c,d,e);this.w=this.I=this.b=null;this.K=!1;this.g=null;this.l=!1;this.i=null;this.u=!1;this.h=new H;this.j=this.f=!1;this.B=0;this.L=15;this.F=!1}q(xe,G);xe.prototype.G=function(a){null!=a.initialStreamBufferSize&&(this.B=Number(a.initialStreamBufferSize));null!=a.streamBufferSize&&(this.L=Number(a.streamBufferSize));null!=a.segmentRequestTimeout&&(this.a.u=Number(a.segmentRequestTimeout))};
xe.prototype.destroy=function(){ye(this);this.h.destroy();this.b=this.h=null;this.a.destroy();this.v=this.c=this.a=null};k=xe.prototype;k.oa=function(){return this.b};k.cb=function(){return this.I};k.sb=function(a){this.f||a.then(function(){this.f=!0;this.g||ze(this,0)}.bind(this)).catch(function(){});return this.h};k.Ga=function(){return this.j};
k.ra=function(a,b,c){if(a!=this.b){var d=[a.H.create(),a.D.create()];Promise.all(d).then(I(this,function(d){if(this.c){var f=this.b;this.b=a;this.I=d[0];this.w=d[1];this.K=!0;this.l||(f?b&&Ae(this,!0,c):ze(this,0))}})).catch(I(this,function(a){"aborted"!=a.type&&(this.f?(a=B(a),this.dispatchEvent(a)):this.h.reject(a))}))}};k.kb=function(){return Ae(this,!1)};
function Ae(a,b,c){a.b&&!a.l&&(a.l=!0,ye(a),Rb(a.a).then(I(a,function(){var a=this.c.currentTime;if(!b&&0<Sb(this.a,a)&&0<=Xb(this.a.b,a))return Promise.resolve();if(c)return $b(this.a,this.c.currentTime+c);this.F=!0;return Zb(this.a)})).then(I(a,function(){this.l=!1;ze(this,0)})).catch(I(a,function(a){this.l=!1;this.f?(a=B(a),this.dispatchEvent(a)):this.h.reject(a)})))}k.lb=function(a){return 0<Sb(this.a,a)&&0<=Xb(this.a.b,a)};k.va=function(){};k.Da=function(){return!0};
k.Nb=function(){if(this.u&&!this.f)this.g=null;else{var a;if(a=this.f&&!this.j)a=1<this.a.c.buffered.length?!0:!1;if(a)Ae(this,!0);else{this.g=null;a=this.b;var b=this.I,c=this.c.currentTime;Sb(this.a,this.u?c:c+(this.i||0))>=(this.u?Math.max(this.B,this.L):this.B)?(Be(this),ze(this,1E3/(Math.abs(this.c.playbackRate)||1))):(b=Ce(this,c,b))?(b=Tb(this.a,b,a.c,this.w),this.w=null,this.K&&(this.K=!1,De(this,a)),this.j=!1,b.then(I(this,function(a){null==this.i&&(this.i=a);this.F&&0<Sb(this.a,c)&&(this.F=
!1,this.c.currentTime+=.001);ze(this,0)})).catch(I(this,function(a){if("aborted"!=a.type){var b=[0,404,410];"net"==a.type&&-1!=b.indexOf(a.ac.status)&&this.b&&ze(this,5E3);a=B(a);this.dispatchEvent(a)}}))):(Be(this),this.f&&!this.j&&(this.j=!0,Ee(this)),ze(this,1E3))}}};function Ce(a,b,c){a=a.a;var d=a.b.length;a=0<d?a.b[d-1]:null;return null!=a?null!=a.a?c.la(a.a):null:c.la(b)||(c.length()?c.A():null)}
function Be(a){if(!a.u&&null!=a.i){a.u=!0;var b=a.a,c=a.i,d=c-b.w;0!=d&&(b.b=Sd(b.b,d),b.w=c);a.h.resolve(a.i)}}function De(a,b){var c;c=b.a.split("/")[0];c=A({type:"adaptation",bubbles:!0,contentType:c,size:"video"!=c?null:{width:b.width,height:b.height},bandwidth:b.bandwidth});a.dispatchEvent(c)}function Ee(a){var b=A({type:"ended"});a.dispatchEvent(b)}function ze(a,b){a.g=window.setTimeout(a.Nb.bind(a),b)}function ye(a){null!=a.g&&(window.clearTimeout(a.g),a.g=null)};function Fe(a){this.b=a;this.a=null}Fe.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};Fe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new Nd(0,null,this.b);this.a=new S([a]);return Promise.resolve(this.a)};function Ge(a,b){G.call(this,a);this.b=b;this.g=!0;this.h=this.f=null;this.c=new H;this.a=null}q(Ge,G);Ge.prototype.G=function(){};Ge.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.c.destroy();this.v=this.b=this.f=this.h=this.a=this.c=null};k=Ge.prototype;k.oa=function(){return this.f};k.cb=function(){return this.h};k.sb=function(){return this.c};k.Ga=function(){return!0};
k.ra=function(a){a.H.create().then(I(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.f;this.f=a;this.h=b;b=T(b).url.b[0].toString();var d=this.Da();this.a&&(this.va(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.va(d);b=A({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.c.resolve(0)}}))};k.kb=function(){};
k.lb=function(){return!0};k.va=function(a){this.g=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};k.Da=function(){this.a&&(this.g="showing"==this.a.track.mode);return this.g};function He(){}
He.prototype.parse=function(a,b,c,d){var e=null;try{var f;var g=new Va(b);if(440786851!=Xa(g).id)f=null;else{var h=Xa(g);if(408125543!=h.id)f=null;else{var l=h.a.byteOffset,m;var n=new Va(h.a);for(b=null;Ra(n.a);){var t=Xa(n);if(357149030==t.id){b=t;break}}if(b){for(var C=new Va(b.a),n=1E6;Ra(C.a);){var u=Xa(C);if(2807729==u.id){n=ab(u);break}}m=n/1E9}else m=null;f=m?{Tb:l,Yb:m}:null}}if(f){var v=Xa(new Va(a));if(475249515!=v.id)e=null;else{var va=f.Tb,Ob=f.Yb;a=[];var be=new Va(v.a);for(f=v=-1;Ra(be.a);){var ce=
Xa(be);if(187==ce.id){var Ja;var de=new Va(ce.a),ee=Xa(de);if(179!=ee.id)Ja=null;else{var xf=ab(ee),fe=Xa(de);if(183!=fe.id)Ja=null;else{for(var ge=new Va(fe.a),l=0;Ra(ge.a);){var he=Xa(ge);if(241==he.id){l=ab(he);break}}Ja={$b:xf,Sb:l}}}if(Ja){var ie=Ob*Ja.$b,je=va+Ja.Sb;if(0<=v){var Rc=new J(d,c,f,je-1);a.push(new Nd(v,ie,Rc))}v=ie;f=je}}}0<=v&&(Rc=new J(d,c,f,null),a.push(new Nd(v,null,Rc)));e=a}}else e=null}catch(ke){if(!(ke instanceof RangeError))throw ke;}return e};function Ie(a,b,c,d,e,f,g){this.g=a;this.i=b;this.f=c;this.a=d;this.c=e;this.j=f;this.b=null;this.h=g}Ie.prototype.destroy=function(){this.h=this.i=this.g=null;this.a.g();this.a=null;this.c&&(this.c.g(),this.c=null);this.b=null};
Ie.prototype.create=function(){if(this.b)return this.b;var a=[Wb(this.a)];"webm"==this.f&&a.push(Wb(this.c));return this.b=Promise.all(a).then(I(this,function(a){var c=a[0];a=a[1]||null;var d=null;"mp4"==this.f?(d=new Td,d=d.parse(new DataView(c),this.a.f,this.a.b,this.h)):"webm"==this.f&&(d=new He,d=d.parse(new DataView(c),new DataView(a),this.a.b,this.h));if(!d)return c=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);
var e;"dynamic"==this.g.type?e=new U(d,this.g,this.i,this.j):e=new S(d);return Promise.resolve(e)}))};function Je(a){this.a=a}
function Ke(a,b,c){for(var d=x()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],g=0;g<f.b.length;++g){var h=f.b[g];if("text"!=h.contentType)for(var l=0;l<h.a.length;++l){var m=h.a[l],n=0,n=n+(m.g?1:0),n=n+(m.b?1:0),n=n+(m.a?1:0);0==n?(h.a.splice(l,1),--l):1!=n&&(m.g?(m.b=null,m.a=null):m.b&&(m.a=null))}}Le(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],g=0;g<f.b.length;++g){l=h=f.b[g];m=null;for(n=0;n<l.a.length;++n){var t=l.a[n].f||"";m?t!=m&&(l.a.splice(n,1),--n):m=t}0==h.a.length&&(f.b.splice(g,1),--g)}"dynamic"==
b.type&&null==b.c&&(b.c=d);e=new we;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new J(c,b.j||b.url),e.h=b.c);e.c=b.h||5;for(f=0;f<b.a.length;++f){g=b.a[f];if(null==g.start)break;g=Me(a,b,g,d,c);e.a.push(g)}return e}
function Le(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].a)&&(a.a[0].a=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],g=a.a[e],h=a.a[e+1]||{start:a.b};!b(g.start)&&f&&b(f.start)&&b(f.a)&&(g.start=f.start+f.a);!b(g.a)&&b(h.start)&&(g.a=h.start-g.start);null!=g.start&&null!=g.a?c+=g.a:d=!1}b(a.b)||(e=a.a[a.a.length-1],d?a.b=c:b(e.start)&&b(e.a)?a.b=e.start+e.a:"dynamic"!=a.type&&
(a.b=c))}}function Me(a,b,c,d,e){var f=new ve;f.id=c.id;f.start=c.start;f.b=c.a;var g=new D;c.b.forEach(function(a){g.push(a.contentType||"",a)});for(var h=qb(g),l=0;l<h.length;++l){var m=new D;g.get(h[l]).forEach(function(a){m.push(a.group,a)});for(var n=qb(m),t=0;t<n.length;++t){var C=new D;m.get(n[t]).forEach(function(a){C.push(a.lang,a)});for(var u=qb(C),v=0;v<u.length;++v){var va=C.get(u[v]),va=Ne(a,b,c,va,d,e);f.a.push(va)}}}return f}
function Ne(a,b,c,d,e,f){ba(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var g=new re,h=d.filter(function(a){return null!=a.id});h.length==d.length&&(g.id=h.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));g.lang=d[0].lang||"";g.contentType=d[0].contentType||"";g.b=d.some(function(a){return a.c});for(var h={},l=0;l<d.length;++l)for(var m=d[l],n=0;n<m.a.length;++n){var t=m.a[n],C=Oe(a,t),u=g.a.slice(0);
Pe(C,u);0==u.length&&0<g.a.length||!(t=Qe(b,c,t,e,f))||(g.m.push(t),g.a=u,h[t.C]=m)}if(g.a.some(function(a){return""==a.a}))return g.m.forEach(function(a){a.N=!0}),g;a=Re(d);for(l=0;l<g.m.length;++l)t=g.m[l],m=h[t.C],m==a&&(t.N=!0);return g}function Re(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var g=e.a[f],g=(g.width||1)*(g.height||1)*(g.bandwidth||1);if(null==b||g<b)b=g,c=e}return c}
function Pe(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],g=a[e];if(f.a==g.a&&f.h==g.h&&f.i==g.i&&f.g==g.g&&f.v==g.v&&f.f==g.f&&f.j==g.j&&Za(f.c,g.c)){d=!0;hc(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}function Oe(a,b){var c=[];if(0==b.c.length)c.push(new fc);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,Se(a,b.c[d]));return c}
function Se(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.c||"",b.f);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f=gc(d[e]);0==f.b.length&&b.a&&b.a.psshBox&&hc(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function Qe(a,b,c,d,e){if(!c.s||0===c.s.length)return null;var f=null,g=1,h=0;if(c.g)f=c.f.split("/")[1],"mp4"!=f&&"webm"!=f?f=null:(g=c.g,"webm"!=f||g.c?g.a||g.b&&g.b.a?(h=g.b,h||(h=new jd,h.url=c.s,h.a=g.a?g.a.clone():null),h=Te(h,e),g=g.c?Te(g.c,e):null,a=new Ie(a,b,f,h,g,d,e),b=new Qd(g),d=new oe,d.H=a,d.D=b,f=d):f=null:f=null),g=c.g.g,h=c.g.f;else if(c.b)f=c.b,!f.b&&!f.c&&1<f.a.length?f=null:f.b||b.a||f.c||1!=f.a.length?f.c&&0===f.c.a.length?f=null:(f=f.h?Te(f.h,e):null,a=new le(a,b,c,d,e),b=
new Qd(f),d=new oe,d.H=a,d.D=b,f=d):f=null,g=c.b.f,h=c.b.g;else if(c.a){a:if(f=c.a,g=0+(f.g?1:0),g+=f.f?1:0,g+=f.b?1:0,0==g?g=!1:(1!=g&&(f.g?(f.f=null,f.b=null):f.f&&(f.b=null)),g=!0),g){g=null;if(f.h&&(g=(f=c.a.h)?Ue(c,f,kd):null,!g)){f=null;break a}f=g?Te(g,e):null;g=c.a;g.g?(g=c.f.split("/")[1],"mp4"!=g&&"webm"!=g?a=null:"webm"!=g||f?Md(e,c,1,0)?(h=(h=c.a.g)?Ue(c,h,jd):null)?(h=Te(h,e),a=new Ie(a,b,g,h,f,d,e)):a=null:a=null:a=null):a=g.i?g.f?new me(a,b,c,d,e):g.b?"dynamic"!=a.type&&null==b.a?null:
new ae(a,b,c,d,e):null:null;a?(b=new Qd(f),d=new oe,d.H=a,d.D=b,f=d):f=null}else f=null;g=c.a.a;h=c.a.j}else"text"==c.f.split("/")[0]&&(f=new oe,f.H=new Fe(new J(e,c.s)));if(!f)return null;f.id=c.id;h&&(f.c=-1*h/g);f.bandwidth=c.bandwidth;f.width=c.width;f.height=c.height;f.a=c.f||"";f.b=c.h||"";for(a=0;a<c.c.length;++a)b=c.c[a],b.b&&f.f.push(b.b);return f}function Ue(a,b,c){b=Od(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=Hd(a.s,b);return c}
function Te(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.na,e=a.a.end);return new J(b,c,d,e)};function Ve(){this.streamStats=null;this.droppedFrames=this.decodedFrames=NaN;this.bufferingTime=this.playTime=this.estimatedBandwidth=0;this.playbackLatency=NaN;this.bufferingHistory=[];this.bandwidthHistory=[];this.streamHistory=[]}function We(a,b){var c=new Xe(b);a.streamHistory.push(new Ye(c));if(c.videoHeight||!a.streamStats)a.streamStats=c}function Xe(a){this.videoWidth=a.width;this.videoHeight=a.height;this.videoMimeType=a.a;this.videoBandwidth=a.bandwidth}
function Ye(a){this.timestamp=x()/1E3;this.value=a};function Ze(a,b){Ab.call(this,"readwrite",b);this.j=a;this.b=0}q(Ze,Ab);
function $e(a,b,c,d,e){for(var f=[],g=[],h=0,l=0,m=[],n=b.map(function(a){return a.H.create()}),n=Promise.all(n),t=b.map(function(a){return a.D.create()}),t=Promise.all(t),n=Promise.all([n,t]).then(function(a){f=a[0];g=a[1];h=f.reduce(function(a,b){return a+b.length()},0)}),t=0;t<b.length;++t)n=n.then(function(a){return af(this,b[a],f[a],g[a],h,l)}.bind(a,t)),n=n.then(function(a,b){l+=f[a].length();m.push(b)}.bind(a,t));return n.then(I(a,function(){return bf(Hb(this))})).then(I(a,function(a){var b=
new H;c=Na(c);var f={group_id:a,stream_ids:m,session_ids:c,duration:d,key_system:e.a,license_server:e.h,with_credentials:e.i,distinctive_identifier:e.g,audio_robustness:e.f,video_robustness:e.j},g=Hb(this).put(f);g.onsuccess=function(){b.resolve(a)};g.onerror=function(){b.reject(g.error)};return b}))}function cf(a,b){return Ib(Hb(a),b).then(I(a,function(a){var d=[],e;for(e in a.stream_ids)d.push(df(this,a.stream_ids[e]));a=Hb(this);d.push(a.delete(b));return Promise.all(d)}))}
function af(a,b,c,d,e,f){var g=[bf(Gb(a)),bf(Eb(a).index("stream"))],g=Promise.all(g).then(I(a,function(a){return{qa:Math.max(a[0],a[1]),ja:new ArrayBuffer(0),Ja:0,o:[],Ca:null,Zb:e,jb:f}})),g=g.then(a.f.bind(a,c));return g=g.then(a.g.bind(a,b,d))}function bf(a){var b=new H,c=a.openCursor(null,"prev");c.onsuccess=function(a){a.target.result?b.resolve(a.target.result.key+1):b.resolve(0)};c.onerror=function(){b.reject(c.error)};return b}
Ze.prototype.g=function(a,b,c){var d=new H;a={stream_id:c.qa,mime_type:a.a,codecs:a.b,init_segment:b,references:c.o};var e=Gb(this).put(a);e.onsuccess=function(){d.resolve(c.qa)};e.onerror=function(){d.reject(e.error)};return d};Ze.prototype.f=function(a,b){for(var c=Promise.resolve(),d=0;d<a.length();++d)var e=a.get(d),f=d==a.length()-1,f=this.c.bind(this,e,b,f),c=c.then(this.i.bind(this,e)),c=c.then(f);return c.then(function(){return Promise.resolve(b)}).catch(I(this,function(a){df(this,b.qa);return Promise.reject(a)}))};
Ze.prototype.c=function(a,b,c,d){var e=new H;0==b.ja.byteLength&&(b.Ca=a);b.ja=ef(b.ja,d);b.jb++;var f=A({type:"progress",detail:b.jb/b.Zb*100,bubbles:!0});if(1048576<=b.ja.byteLength||c){c={stream_id:b.qa,segment_id:b.Ja,content:b.ja};var g=Eb(this).put(c);b.o.push({start_time:b.Ca.b,start_byte:b.Ca.url.f,end_time:a.a,url:"idb://"+b.qa+"/"+b.Ja});b.Ja++;b.ja=new ArrayBuffer(0);g.onerror=function(){e.reject(g.error)};g.onsuccess=I(this,function(){this.dispatchEvent(f);e.resolve()})}else this.dispatchEvent(f),
e.resolve();return e};function ef(a,b){var c=new Uint8Array(a.byteLength+b.byteLength);c.set(new Uint8Array(a),0);c.set(new Uint8Array(b),a.byteLength);return c.buffer}Ze.prototype.i=function(a){var b=new Vb;b.c=1E3*this.b;return Wb(a.url,b,this.j)};
function df(a,b){var c=new H,d=Gb(a).delete(b);d.onerror=function(){c.reject(d.error)};var e=Eb(a);e.index("stream").openKeyCursor(IDBKeyRange.only(b)).onsuccess=function(a){if(a=a.target.result)e.delete(a.primaryKey),a.continue()};e.transaction.oncomplete=function(){c.resolve()};return c};function ff(a,b,c,d,e,f){this.b=new J(null,[new K(a)]);this.a=new Vb;this.a.body=b;this.a.method=c;this.a.a=3;this.a.j=d;this.a.c=1E3*(null!=f?f:0);a=e||{};for(var g in a)this.a.b[g]=a[g]}function gf(a){return Wb(a.b,a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function hf(a,b,c){G.call(this,a);this.h=b;this.b=c;this.a=this.i=null;this.l=new E;this.c=[];this.f=[];this.u=0;this.g=new H;this.j=null;this.w=0}q(hf,G);hf.prototype.destroy=function(){this.v=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.c=this.a=this.i=null;this.g.destroy();this.g=null;this.l.destroy();this.l=null;this.j&&(window.clearTimeout(this.j),this.j=null);this.h=this.b=null};
hf.prototype.initialize=function(){for(var a=new D,b=this.b.bb(),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!jf(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var g=f.a.a,h=c[g];h||(h=f.a,h={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:h.g?"required":"optional",persistentState:h.v||this.b.ha()?"required":"optional",sessionTypes:[this.b.ha()?"persistent-license":"temporary"]},
c[g]=h);if(f.b&&(g=f.contentType+"Capabilities",g in h)){d=!0;h[g]||(h[g]=[]);var l;"audio"==f.contentType?l=f.a.f:"video"==f.contentType&&(l=f.a.j);h[g].push({contentType:f.b,robustness:l})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return this.b.Ka(a),this.g.resolve(),Promise.resolve();l=new H;c=kf(this,c,l);c=c.then(this.tb.bind(this,b,a));c=c.then(this.Ub.bind(this));l.reject(null);return c};
function lf(a,b){null==a.j&&(a.j=window.setTimeout(function(){var a=Error("Timeout waiting for sessions.");a.type="storage";this.g.reject(a)}.bind(a),b));return a.g}function mf(a){return Promise.all(a.f.map(function(a){return a.remove()}))}
function kf(a,b,c){for(var d in b)c=c.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,d,b[d]));a.b.ha()&&(c=c.catch(function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.");}));return c}k=hf.prototype;
k.tb=function(a,b,c){if(!this.h)return nf();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],g=0;g<f.length;++g){var h=f[g];if(!b.a.hasOwnProperty(h)){var l=e[h+"Capabilities"];if(l&&l.length){for(var l=l[0],m=[],n={},t=0;t<a.length;++t){var C=a[t];if(C.a.a==d&&C.b==l.contentType&&!(C.id in n)){m.push(C);n[C.id]=!0;var u;if(this.a){u=this.a;var C=C.a,v=new fc;v.a=u.a;v.h=u.h;v.i=u.i;v.l=u.l;v.u=u.u;v.g=u.g;v.v=u.v;v.f=u.f;v.j=u.j;v.c=u.c?new Uint8Array(u.c.buffer):null;hc(v,u.b);hc(v,
C.b);u=v}else u=C.a;this.a=u}}b.set(h,m)}}}this.b.Ka(b);return c.createMediaKeys()};
k.Ub=function(a){if(!this.h)return nf();this.i=a;return this.h.setMediaKeys(this.i).then(I(this,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():nf()})).then(I(this,function(){if(!this.h)return nf();if(0<this.b.ua().length)of(this);else{for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.eb({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&F(this.l,this.h,"encrypted",this.eb.bind(this))}}))};
function nf(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
k.eb=function(a){for(var b=new Uint8Array(a.initData),c=0;c<this.c.length;++c)if(Za(b,this.c[c].data))return;try{var d=pf(this)}catch(e){b=B(e);this.dispatchEvent(b);this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.c.push({data:b,La:d});a.catch(I(this,function(a){if(this.h){for(var b=0;b<this.c.length;++b)if(this.c[b].La==d){this.c.splice(b,1);break}b=B(a);this.dispatchEvent(b);this.g.reject(a)}}));this.f.push(d)};
function of(a){for(var b=a.b.ua(),c=0;c<b.length;++c){var d=pf(a),e=d.load(b[c]);a.f.push(d);e.then(I(a,function(){this.u++;this.u>=this.f.length&&this.g.resolve()})).catch(I(a,function(a){a=B(a);this.dispatchEvent(a)}))}}
function pf(a){var b=null;if(a.b.ha())try{b=a.i.createSession("persistent-license")}catch(c){throw Error("Persistent licenses are not supported by this key system or platform.");}else b=a.i.createSession();F(a.l,b,"message",a.Jb.bind(a));F(a.l,b,"keystatuseschange",a.yb.bind(a));return b}k.Jb=function(a){qf(this,a.target,this.a,a.message)};
k.yb=function(a){a=a.target;for(var b=a.keyStatuses,c={},d=b.keys(),e=d.next();!e.done;e=d.next()){var f=ec(new Uint8Array(e.value)),e=b.get(e.value);c[f]=e}if(a.expiration<Date.now()){for(b=0;b<this.c.length;++b)if(this.c[b].La==a){this.c.splice(b,1);break}a.close();this.f.splice(this.f.indexOf(a),1)}this.b.fb(c)};
function qf(a,b,c,d){d=rf(c,d);gf(new ff(d.url,d.body,d.method,c.i,d.headers,a.w)).then(I(a,function(a){c.l&&(a=c.l(a));return b.update(a)})).then(I(a,function(){var a=A({type:"sessionReady",detail:b});this.dispatchEvent(a);this.u++;this.u>=this.f.length&&this.g.resolve()})).catch(I(a,function(a){a.La=b;a=B(a);this.dispatchEvent(a)}))}
function rf(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),g=0;g<e.length;g++)c.headers[e[g].childNodes[0].nodeValue]=f[g].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.u)return c;a.u(c);c.url=mb(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"==typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=mb(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=nb(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function V(a){G.call(this,null);this.a=a;this.b=null;this.f=new E;this.i=this.j=null;this.F=0;this.w=null;this.h=!1;this.g=new Ve;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new ja};this.l=1;this.G=null}q(V,G);p("shaka.player.Player",V);V.version="v1.6.0-3-g3e74226";
V.isBrowserSupported=function(){return!!window.MediaSource&&!!window.MediaKeys&&!!window.navigator&&!!window.navigator.requestMediaKeySystemAccess&&!!window.MediaKeySystemAccess&&!!window.MediaKeySystemAccess.prototype.getConfiguration&&!!window.Promise&&!!Element.prototype.requestFullscreen&&!!document.exitFullscreen&&"fullscreenElement"in document&&!!window.Uint8Array};function jf(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}V.isTypeSupported=jf;
V.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+oa(a)+" }",0)};V.prototype.destroy=function(){return this.u().then(I(this,function(){this.f.destroy();this.a=this.f=null})).catch(function(){})};V.prototype.destroy=V.prototype.destroy;
V.prototype.u=function(){if(!this.b)return Promise.resolve();this.h&&sf(this);this.a.pause();rb(this.f);tf(this);uf(this);this.j&&(this.j.destroy(),this.j=null);this.a.src="";var a=this.a.setMediaKeys(null);this.b&&(this.b.destroy(),this.b=null);this.h=!1;this.g=new Ve;return a};V.prototype.unload=V.prototype.u;
V.prototype.ea=function(a){var b=this.u();this.a.autoplay&&(da("load"),F(this.f,this.a,"timeupdate",this.xb.bind(this)));a.T(this.c);a.pb(this.G);this.G=null;b=b.then(I(this,function(){return a.X()}));b.catch(I(this,function(b){a.destroy();return Promise.reject(b)}));return b.then(I(this,function(){if(!this.a)return vf();this.b=a;F(this.f,this.b,"seekrangechanged",this.Hb.bind(this));this.j=new hf(this,this.a,this.b);return this.j.initialize()})).then(I(this,function(){if(!this.a)return vf();F(this.f,
this.a,"error",this.Vb.bind(this));F(this.f,this.a,"playing",this.Fb.bind(this));F(this.f,this.a,"pause",this.Eb.bind(this));return this.b.Wa(this,this.a)})).then(I(this,function(){if(!this.a)return vf();wf(this)})).catch(I(this,function(a){if(!this.a)return vf();if("destroy"!=a.type){var b=B(a);this.dispatchEvent(b)}return this.u().then(function(){return Promise.reject(a)})}))};V.prototype.load=V.prototype.ea;
function vf(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}k=V.prototype;k.xb=function(){ga("load");this.g.playbackLatency=ha("load")/1E3;this.f.sa(this.a,"timeupdate")};k.Vb=function(){if(this.a.error){var a=this.a.error.code;a!=MediaError.MEDIA_ERR_ABORTED&&(a=Error(yf[a]||"Unknown playback error."),a.type="playback",a=B(a),this.dispatchEvent(a))}};
k.Fb=function(){da("playing");!this.i&&0>this.l&&(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),this.l));this.h&&sf(this)};k.Eb=function(){ga("playing");var a=ha("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3}uf(this)};k.Hb=function(a){this.F=a.start};
k.qb=function(){if(!this.a.paused){ga("playing");var a=ha("playing");if(!isNaN(a)){var b=this.g;b.playTime+=a/1E3;da("playing")}}a=this.g;b=this.a;b.getVideoPlaybackQuality&&(b=b.getVideoPlaybackQuality(),a.decodedFrames=b.totalVideoFrames,a.droppedFrames=b.droppedVideoFrames);return this.g};V.prototype.getStats=V.prototype.qb;V.prototype.da=function(){return this.b?this.b.ma():[]};V.prototype.getVideoTracks=V.prototype.da;V.prototype.Y=function(){return this.b?this.b.pa():[]};
V.prototype.getAudioTracks=V.prototype.Y;V.prototype.$=function(){return this.b?this.b.Oa():[]};V.prototype.getTextTracks=V.prototype.$;V.prototype.selectVideoTrack=function(a,b){return this.b?this.b.selectVideoTrack(a,void 0==b?!0:b):!1};V.prototype.selectVideoTrack=V.prototype.selectVideoTrack;V.prototype.M=function(a,b){return this.b?this.b.nb(a,void 0==b?!0:b):!1};V.prototype.selectAudioTrack=V.prototype.M;V.prototype.fa=function(a){return this.b?this.b.ob(a,!1):!1};
V.prototype.selectTextTrack=V.prototype.fa;V.prototype.V=function(a){this.b&&this.b.Na(a)};V.prototype.enableTextTrack=V.prototype.V;V.prototype.T=function(a){uf(this);0<=a?this.a.playbackRate=a:this.a.paused||(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),a));this.l=a};V.prototype.setPlaybackRate=V.prototype.T;V.prototype.K=function(){return this.l};V.prototype.getPlaybackRate=V.prototype.K;V.prototype.R=function(a){this.G=a};V.prototype.setPlaybackStartTime=V.prototype.R;
V.prototype.I=function(){return this.b?this.b.mb():!1};V.prototype.isLive=V.prototype.I;
V.prototype.U=function(a){if(a){var b=lb(a,"enableAdaptation","boolean");null!=b&&(this.c.enableAdaptation=b);b=kb(a,"streamBufferSize");null!=b&&(this.c.streamBufferSize=b);b=kb(a,"liveStreamEndTimeout");null!=b&&(this.c.liveStreamEndTimeout=b);b=kb(a,"licenseRequestTimeout");null!=b&&(this.c.licenseRequestTimeout=b);b=kb(a,"mpdRequestTimeout");null!=b&&(this.c.mpdRequestTimeout=b);b=kb(a,"segmentRequestTimeout");null!=b&&(this.c.segmentRequestTimeout=b);b=mb(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=
b);a=nb(a,"restrictions",ja);null!=a&&(this.c.restrictions=a.clone());this.b&&this.b.T(this.c)}};V.prototype.configure=V.prototype.U;V.prototype.Z=function(){return this.c};V.prototype.getConfiguration=V.prototype.Z;function uf(a){a.i&&(window.clearTimeout(a.i),a.i=null)}function wf(a){tf(a);a.w=window.setTimeout(a.L.bind(a),100)}function tf(a){a.w&&(window.clearTimeout(a.w),a.w=null)}
V.prototype.B=function(a,b,c){this.i=null;var d=(Date.now()-b)/1E3*c;this.a.currentTime<this.F+(this.I()?1:.05)?this.a.pause():(d=Math.max(this.F,a+d),this.a.currentTime=d,this.i=window.setTimeout(this.B.bind(this,a,b,c),250))};function sf(a){ga("buffering");var b=a.g;b.bufferingTime+=ha("buffering")/1E3;a.h=!1;a.dispatchEvent(A({type:"bufferingEnd"}))}
V.prototype.L=function(){wf(this);if(!this.a.ended&&!this.a.seeking){var a=this.a.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.a.currentTime,0),c=this.a.duration,c=isNaN(c)?0:Math.max(c-.05,0),b=b>=c||this.a.currentTime>=c;if(this.h){if(c=this.b.ab(),b||a>c)sf(this),this.a.play()}else!this.a.paused&&!b&&.5>a&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(x()/1E3),da("buffering"),this.dispatchEvent(A({type:"bufferingStart"})))}};
var yf={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function zf(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,g=0;g<f.m.length;++g)jf(qe(f.m[g]))||(f.m.splice(g,1),--g);0==e.m.length&&(c.a.splice(d,1),--d)}}function Af(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d)c.a[d].m.sort(Bf)}function Bf(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function Cf(a){this.a=a}Cf.prototype.destroy=function(){this.a.destroy();this.a=null};Cf.prototype.update=function(a){var b=Df(a),c=Df(this.a);return Promise.all([b,c]).then(I(this,function(b){var c=b[0];b=b[1];var f=this.a.a;zf(f);Af(f);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;f=[];Ef(a,this.a,c,b,f);c=a.a;zf(c);Af(c);return Promise.resolve(f)}))};
function Df(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.m}).reduce(b,[]);a=c.map(function(a){return a.H.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].C]=a[f];return Promise.resolve(b)})}
function Ef(a,b,c,d,e){var f=new D;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=qb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&(Ff(l[0],h[0],c,d,e),l[0].b=h[0].b)}}
function Ff(a,b,c,d,e){var f=new D;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.a.forEach(function(a,b){g.push(a.id||""+b,a)});a=qb(f);for(b=0;b<a.length;++b){var h=a[b],l=f.get(h);1<l.length||(h=g.get(h))&&0!=h.length&&1==h.length&&Gf(l[0],h[0],c,d,e)}}
function Gf(a,b,c,d,e){var f=new D;a.m.forEach(function(a,b){f.push(a.id||""+b,a)});var g=new D;b.m.forEach(function(a,b){g.push(a.id||""+b,a)});b={};for(var h=qb(f),l=0;l<h.length;++l){var m=h[l];b[m]=m;var n=f.get(m);1<n.length||((m=g.get(m))&&0!=m.length?1==m.length&&(Hf(n[0],m[0],c,d),n[0].D=m[0].D,m[0].D=null,n[0].c=m[0].c):(e.push(n[0]),a.m.splice(a.m.indexOf(n[0]),1)))}h=qb(g);for(l=0;l<h.length;++l)m=h[l],b[m]||(b[m]=m,m=g.get(m),a.m.push(m[0]))}
function Hf(a,b,c,d){a=c[a.C];b=d[b.C];a.length();a.Ha(b)&&a.length()};function W(){this.a=this.b=null;this.f=new E;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}p("shaka.media.SimpleAbrManager",W);W.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};W.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
W.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,F(this.f,this.b,"bandwidth",this.v.bind(this)),F(this.f,this.a,"adaptation",this.j.bind(this)),F(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};W.prototype.enable=function(a){this.i=a};W.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=If(this);return a?a.id:null};W.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};
W.prototype.v=function(){Date.now()<this.c||this.h()};W.prototype.h=function(){if(this.i){var a=If(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};W.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function If(a){var b=a.a.ma();if(0==b.length)return null;b.sort(sa);var c;a:{c=a.a.pa();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],g=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(g=(g.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=g&&(d=f,d.active)))break}return d};function Jf(a,b,c){G.call(this,null);this.f=a;this.c=b;this.b=gc(c);this.a=null}q(Jf,G);p("shaka.player.HttpVideoSource",Jf);Jf.prototype.T=function(){};Jf.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null);this.v=this.b=null};k=Jf.prototype;k.Wa=function(a,b){this.v=a;var c=b.mediaKeys;b.src=this.f;c=b.setMediaKeys(c);this.c&&(this.a=document.createElement("track"),this.a.src=this.c,b.appendChild(this.a),this.a.track.mode="showing");return c};k.X=function(){return Promise.resolve()};
k.ma=function(){return[]};k.pa=function(){return[]};k.Oa=function(){return[]};k.ab=function(){return 5};k.bb=function(){var a=new ue;a.a=this.b;return[a]};k.Ka=function(){};Jf.prototype.selectVideoTrack=function(){return!1};k=Jf.prototype;k.nb=function(){return!1};k.ob=function(){return!1};k.Na=function(a){this.a&&(this.a.track.mode=a?"showing":"disabled")};k.pb=function(){};k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return!1};
k.fb=function(a){for(var b in a){var c=a[b],d=bb[c]||null;if(d){var e=vb(b),d=Error("Key "+e+" is not usable. "+d);d.type="drm";d.code=c;c=B(d);this.dispatchEvent(c)}}};function X(a,b,c){G.call(this,null);this.a=a;this.Z=b;this.i=new E;this.g=new MediaSource;this.f=null;this.da=0;this.b=new D;this.I=c;this.I.initialize(b,this);this.L=!1;this.K="en";this.fa=!1;this.U=null;this.B=new H;this.h=new ja;this.F=null;this.Va=1;this.c={};this.ea=new H;this.Ta=0;this.Ua=15;this.w=null;this.Ra=this.Sa=!1;this.u={};this.$=this.Y=this.V=null;this.G={}}q(X,G);p("shaka.player.StreamVideoSource",X);
X.prototype.T=function(a){null!=a.streamBufferSize&&(this.G.streamBufferSize=a.streamBufferSize);null!=a.segmentRequestTimeout&&(this.G.segmentRequestTimeout=a.segmentRequestTimeout);Kf(this);null!=a.enableAdaptation&&this.I.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.da=Number(a.mpdRequestTimeout));null!=a.liveStreamEndTimeout&&(this.Ua=Number(a.liveStreamEndTimeout));null!=a.preferredLanguage&&(this.K=fb(String(a.preferredLanguage)));null!=a.restrictions&&(this.h=a.restrictions,
this.L&&Lf(this))};X.prototype.destroy=function(){this.B.destroy();this.ea.destroy();this.ea=this.B=null;this.Y&&(window.clearTimeout(this.Y),this.Y=null);this.V&&(window.clearTimeout(this.V),this.V=null);this.u=null;this.i.destroy();this.i=null;jb(this.c).forEach(function(a){a.destroy()});this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.I.destroy();this.v=this.h=this.U=this.f=this.g=this.Z=this.I=null};k=X.prototype;
k.Wa=function(a,b){if(!this.L){var c=Error("Cannot call attach() right now.");c.type="app";return Promise.reject(c)}this.v=a;this.f=b;this.U=a.qb();F(this.i,this.g,"sourceopen",this.Ab.bind(this));F(this.i,this.Z,"bandwidth",this.Wb.bind(this));this.a.b&&(F(this.i,a,"bufferingStart",this.wb.bind(this)),F(this.i,a,"bufferingEnd",this.vb.bind(this)));c=this.f.mediaKeys;this.f.src=window.URL.createObjectURL(this.g);c=this.f.setMediaKeys(c);return Promise.all([this.B,c])};
k.X=function(){if(this.L){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);a=this.a.a;zf(a);Af(a);if(0==this.a.a.length||0==this.a.a[0].a.length)return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.L=!0;this.G.initialStreamBufferSize=this.a.c;Kf(this);Lf(this);
return Promise.resolve()};k.ib=function(a){var b=Date.now(),c=this.V=null,d=this.a.g;(a?this.gb():this.hb(d)).then(I(this,function(a){c=new Cf(a);return c.update(this.a)})).then(I(this,function(a){c.destroy();c=null;for(var d=0;d<a.length;++d)Mf(this,a[d]);this.G.initialStreamBufferSize=this.a.c;Kf(this);Lf(this);0==Object.keys(this.c).length?Nf(this):Of(this,(Date.now()-b)/1E3)})).catch(I(this,function(a){c&&(c.destroy(),c=null);"aborted"!=a.type&&(a=B(a),this.dispatchEvent(a),this.a&&Of(this,0))}))};
k.hb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};k.gb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};function Of(a,b){if(null!=a.a.f){var c=Math.max(a.a.f,3),c=Math.max(c-b,0);a.V=window.setTimeout(a.ib.bind(a,!1),1E3*c)}}
function Mf(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.oa()==b){var e=a.b.get(b.a.split("/")[0]).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.N&&a.J});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=B(c);a.dispatchEvent(c);return}a.u[c].Pa==b&&delete a.u[c];d.ra(e[0],!0);b.destroy()}b.destroy()}
k.ma=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.m.length;++f){var g=e.m[f];if(g.N&&g.J){var h=g.C,g=new ra(h,g.bandwidth,g.width,g.height);h==a&&(g.active=!0);b.push(g)}}return b};X.prototype.getVideoTracks=X.prototype.ma;
X.prototype.pa=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.oa():null)?a.C:0,b=[],c=this.b.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,g=0;g<e.m.length;++g){var h=e.m[g];if(h.N&&h.J){var l=h.C,h=new ia(l,h.bandwidth,f);l==a&&(h.active=!0);b.push(h)}}return b};X.prototype.getAudioTracks=X.prototype.pa;
X.prototype.Oa=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.oa():null,b=b?b.C:0,c=[],d=this.b.get("text"),e=0;e<d.length;++e)for(var f=d[e],g=f.lang,h=0;h<f.m.length;++h){var l=f.m[h].C,m=new qa(l,g);l==b&&(m.active=!0,m.enabled=a.Da());c.push(m)}return c};X.prototype.getTextTracks=X.prototype.Oa;X.prototype.ab=function(){return Number(this.G.initialStreamBufferSize)};
X.prototype.bb=function(){var a;if(this.L){a=this.a.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,te(a.a[c]));a=b}else a=[];return a};
X.prototype.Ka=function(a){if(this.L){for(var b={},c=this.a.a[0],d=0;d<c.a.length;++d){var e=c.a[d];b[e.C]=e}this.b.a={};c=qb(a);for(d=0;d<c.length;++d){var e=c[d],f=a.get(e);if("video"==e){var g=f[0].id;this.b.push(e,b[g])}else if("audio"==e)for(var g=f[0].b.split(";")[0],h=0;h<f.length;++h){var l=f[h];l.b.split(";")[0]==g&&this.b.push(e,b[l.id])}else for(h=0;h<f.length;++h)g=f[h].id,this.b.push(e,b[g])}this.fa=!0;if(a=this.b.get("audio"))Pf(this,a),this.b.set("audio",a),a=a[0].lang||this.K,eb(2,
this.K,a)&&(this.fa=!1);if(a=this.b.get("text"))Pf(this,a),this.b.set("text",a),a=a[0].lang||this.K,eb(2,this.K,a)||(this.fa=!1)}};X.prototype.selectVideoTrack=function(a,b,c){return Qf(this,"video",a,b,c)};k=X.prototype;k.nb=function(a,b){return Qf(this,"audio",a,b)};k.ob=function(a,b){return Qf(this,"text",a,b)};k.Na=function(a){var b=this.c.text;b&&b.va(a)};k.pb=function(a){this.$=a};
function Lf(a){if(a.h){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var g=0;g<f.m.length;++g){var h=f.m[g],l=h.J;h.J=!0;a.h.maxWidth&&h.width>a.h.maxWidth&&(h.J=!1);a.h.maxHeight&&h.height>a.h.maxHeight&&(h.J=!1);a.h.minHeight&&h.height<a.h.minHeight&&(h.J=!1);a.h.maxBandwidth&&h.bandwidth>a.h.maxBandwidth&&(h.J=!1);a.h.minBandwidth&&h.bandwidth<a.h.minBandwidth&&(h.J=!1);l!=h.J&&(b=!0)}}0!=ob(a.b).length&&b&&(Rf(a),0<a.ma().length||
(b=Error("The application has restricted all video tracks!"),b.type="app",b=B(b),a.dispatchEvent(b)))}}k.ua=function(){return[]};k.ha=function(){return!1};k.mb=function(){return this.a?this.a.b:!1};
k.fb=function(a){for(var b,c=!1,d=new D,e=ob(this.b),f=0;f<e.length;++f)for(var g=e[f],h=0;h<g.m.length;++h){var l=g.m[h];l.f.forEach(function(a){d.push(a,l)})}for(b in a)if(e=bb[a[b]]||null,g=d.get(b))for(f=0;f<g.length;++f)l=g[f],h=l.N,l.N=!e,h!=l.N&&(c=!0);else vb(b);c&&(Rf(this),b=this.pa(),a=this.ma(),b=this.b.a.hasOwnProperty("audio")&&0==b.length,a=this.b.a.hasOwnProperty("video")&&0==a.length,b||a)&&(a=Error("The key system has restricted all "+(b&&a?"audio and video tracks.":b?"audio tracks.":
"video tracks.")),a.type="drm",a=B(a),this.dispatchEvent(a))};function Rf(a){var b=A({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function Qf(a,b,c,d,e){if(!a.b.a.hasOwnProperty(b)||!a.c[b])return!1;for(var f=a.b.get(b),g=0;g<f.length;++g)for(var h=f[g],l=0;l<h.m.length;++l){var m=h.m[l];if(m.C==c){if(!m.N||!m.J)return!1;if("text"!=b&&!a.Ra)return c=a.u[b],a.u[b]={Pa:m,Xa:null!=c&&c.Xa||d,Ya:null!=c&&c.Ya||e},!0;We(a.U,m);a.c[b].ra(m,d,e);return!0}}return!1}
function Pf(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(eb(c,a.K,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.b){b.splice(d,1);b.splice(0,0,e);break}}k.Ab=function(){this.i.sa(this.g,"sourceopen");Nf(this).then(I(this,function(){this.B&&this.B.resolve()})).catch(I(this,function(a){this.B&&this.B.reject(a)}))};
function Nf(a){for(var b=[],c=["audio","video","text"],d=0;d<c.length;++d){var e=c[d];a.b.a.hasOwnProperty(e)&&b.push(a.b.get(e)[0])}for(var f=Sf(a,b),d=0;d<c.length;++d)if(e=c[d],a.b.a.hasOwnProperty(e)&&!f[e])return a=Error("Unable to select an initial "+e+" stream: all "+e+" streams have been restricted (by the application or by the key system)."),a.type="stream",Promise.reject(a);b=jb(f).map(function(a){return a.H.create()});return Promise.all(b).then(I(a,function(a){if(!a.every(function(a){return a.length()}))return a=
Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=Tf(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!Uf(this,f))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.I.start();Vf(this,f,a);return Promise.resolve()})).catch(I(a,function(a){if("aborted"!=a.type)return Object.keys(this.c),this.a.b?(x()<this.a.h?(a=Math.max(this.a.h-Date.now()/1E3,3),this.V=window.setTimeout(this.ib.bind(this,
!0),1E3*a)):Of(this,0),Promise.resolve()):Promise.reject(a)}))}function Sf(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var g=a.I.getInitialVideoTrackId();if(null==g)continue;f=e.m.filter(function(a){return a.C==g});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType){f=e.m.filter(function(a){return a.N&&a.J});if(0==f.length)continue;f=e.m[Math.floor(f.length/2)]}else 0<e.m.length&&(f=e.m[0]);c[e.contentType]=f}return c}
function Uf(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new Ge(a,a.f):Wf(a,e);if(!e)return jb(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.c=c;return!0}function Wf(a,b){var c=new xe(a,a.f,a.g,qe(b),a.Z);c.G(a.G);return c}
function Vf(a,b,c){a.Va=a.f.playbackRate;a.f.playbackRate=0;Xf(a,c);var d;a.$&&a.$<=c.end&&a.$>=c.start?d=a.$:a.a.b?(d=c.end,a.Sa=!0):d=c.start;F(a.i,a.f,"seeking",a.Ib.bind(a));a.f.currentTime!=d&&(a.f.currentTime=d,a.F=d);Yf(a,c.start,c.end);c=[];for(var e in a.c){d=a.c[e];c.push(d.sb(a.ea));F(a.i,d,"ended",a.Kb.bind(a));var f=b[e];We(a.U,f);d.ra(f,!1)}Promise.all(c).then(a.ub.bind(a)).catch(I(a,function(a){"destroy"!=a.type&&(a=B(a),this.dispatchEvent(a))}));a.Na(a.fa)}
k.ub=function(a){ba(a&&a.length==Object.keys(this.c).length);for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);a=Zf(this);for(d=0;d<a.length;++d)a[d].ka(c);$f(this,a,c);d=ob(this.b).map(function(a){return a.m}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){var b=[a.H.create()];a.D&&b.push(a.D.create());return Promise.all(b)});Promise.all(d).then(I(this,function(a){for(var b=0;b<a.length;++b)a[b][0].ka(c);this.Ra=
!0;for(var d in this.u)a=this.u[d],b=this.c[d],We(this.U,a.Pa),b.ra(a.Pa,a.Xa,a.Ya);this.u={}})).catch(I(this,function(a){"aborted"!=a.type&&(a=B(a),this.dispatchEvent(a))}))};function $f(a,b,c){if(b=Tf(a,b))Xf(a,b),Yf(a,b.start,b.end);0!=c&&(c=a.f.currentTime+c,a.f.currentTime=c,a.F=c);a.Sa&&b&&(a.f.currentTime=b.end);a.f.playbackRate=a.Va;a.a.b&&null!=a.a.f&&Of(a,0);ag(a);a.ea.resolve()}
function Xf(a,b){if(a.a.b)isNaN(a.g.duration)&&(a.g.duration=b.end+2592E3);else if(isNaN(a.g.duration)||b.end>a.g.duration){a.g.duration=b.end;for(var c=0;c<a.g.sourceBuffers.length;++c)a.g.sourceBuffers[c].appendWindowEnd=b.end}}k.Mb=function(){this.Y=null;ag(this);var a=Tf(this,Zf(this));a&&(this.a.b&&this.Ta!=a.A&&(this.Ta=a.A,null!=this.w&&(window.clearTimeout(this.w),this.w=null)),Yf(this,a.start,a.end),this.f.paused||bg(this,this.f.currentTime,a.start,a.end))};
function Yf(a,b,c){b=A({type:"seekrangechanged",bubbles:!0,start:b,end:c});a.dispatchEvent(b)}k.Ib=function(){var a=this.f.currentTime;if(null!=this.F){if(a>=this.F-.01&&a<=this.F+.01){this.F=null;return}this.F=null}var b=Tf(this,Zf(this));if(b){var c=b.end;(b=bg(this,a,b.start,c))||(a<=c+.01?b=!1:(this.f.currentTime=c,b=!0));if(!b)for(var d in this.c)this.c[d].kb()}};
function bg(a,b,c,d){if(b>=c-.01)return!1;b=0;if(a.a.b){b=.5;for(var e in a.c)if(!a.c[e].lb(c+b)){b=a.a.c;break}}a.f.currentTime=Math.min(c+b,d);return!0}k.Kb=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].Ga())return;this.$a()}};k.wb=function(){jb(this.c).every(function(a){return a.Ga()})&&(this.w=window.setTimeout(this.$a.bind(this),1E3*this.Ua))};k.vb=function(){null!=this.w&&(window.clearTimeout(this.w),this.w=null)};
k.Wb=function(){var a=this.U,b=this.Z.getBandwidth();a.estimatedBandwidth=b;a.bandwidthHistory.push(new Ye(b))};k.$a=function(){this.w=null;this.g.endOfStream()};function Zf(a){return jb(a.c).map(function(a){return a.cb()}).filter(function(a){return null!=a})}
function Tf(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var g=b[f].Ea(),c=Math.max(c,g.start);null!=g.end&&(d=Math.min(d,g.end));b[f].length()&&(e=Math.min(e,b[f].A().a))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.b)d=(d.start||0)+d.b;else return null;a.a.b&&(d=Math.max(d-a.a.c,c));return c>d?null:{start:c,end:d,A:e}}function ag(a){a.a.b&&(a.Y=window.setTimeout(a.Mb.bind(a),1E3))}function Kf(a){for(var b in a.c)a.c[b].G(a.G)};function Y(a,b,c,d){c||(c=new ub);d||(d=new W);X.call(this,null,c,d);this.za=a;this.l=null;this.M=b;this.R=[];this.ga=[];this.ta=[];this.j=null}q(Y,X);p("shaka.player.DashVideoSource",Y);Y.prototype.Aa=function(a,b,c){this.R.push(a);this.ga.push(b||"");this.ta.push(c||"")};Y.prototype.addExternalCaptions=Y.prototype.Aa;Y.prototype.xa=function(a){this.j=a};Y.prototype.setNetworkCallback=Y.prototype.xa;Y.prototype.destroy=function(){this.l=this.j=this.M=null;X.prototype.destroy.call(this)};
Y.prototype.X=function(){var a=new J(this.j,[new K(this.za)]);return Kd(new Jd(a,this.da)).then(I(this,function(a){this.l=a;for(var c=0;c<this.R.length;c++){var d=a,e=this.R[c],f=this.ga[c],g=this.ta[c];if(0!==d.a.length){var h=new $c;h.contentType="text";h.lang=f||"en";h.c=!0;f=new cd;f.bandwidth=0;f.f=g||"text/vtt";f.s=[new K(e)];h.a.push(f);d.a[0].b.push(h);vd(d.a[0])}}this.a=Ke(new Je(this.M),a,this.j);return X.prototype.X.call(this)}))};
Y.prototype.hb=function(a){return Kd(new Jd(a,this.da)).then(I(this,function(a){this.l=a;a=Ke(new Je(this.M),a,this.j);return Promise.resolve(a)}))};Y.prototype.gb=function(){var a=Ke(new Je(this.M),this.l,this.j);return Promise.resolve(a)};function Z(a,b,c){b||(b=new ub);c||(c=new W);X.call(this,null,b,c);this.R=a;this.M=[];this.timeoutMs=3E4;this.l={};this.j=this.ga=null}q(Z,X);p("shaka.player.OfflineVideoSource",Z);Z.prototype.T=function(a){null!=a.licenseRequestTimeout&&(this.l.licenseRequestTimeout=a.licenseRequestTimeout);null!=a.segmentRequestTimeout&&(this.l.segmentRequestTimeout=a.segmentRequestTimeout);X.prototype.T.call(this,a)};
p("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var a=new Jb,b=Bb(a).then(function(){return Kb(a)});b.then(function(){Db(a)}).catch(function(){Db(a)});return b});
Z.prototype.xa=function(a,b,c,d){var e,f=null,g={},h=[];a=new J(this.ga,[new K(a)]);return Kd(new Jd(a,this.da)).then(I(this,function(a){this.a=Ke(new Je(c),a,this.ga);if(this.a.b)return a=Error("Unable to store live streams offline."),a.type="app",Promise.reject(a);this.T({preferredLanguage:b});return X.prototype.X.call(this)})).then(I(this,function(){var a=document.createElement("video");a.src=window.URL.createObjectURL(this.g);e=new hf(null,a,this);null!=this.l.licenseRequestTimeout&&(e.w=Number(this.l.licenseRequestTimeout));
F(this.i,e,"sessionReady",this.ta.bind(this));F(this.i,e,"error",function(a){f=a});return e.initialize()})).then(I(this,function(){for(var a=ob(this.b),b=0;b<a.length;++b)for(var c=a[b],e=0;e<c.m.length;++e){var f=c.m[e];g[f.C]=f}return d()})).then(I(this,function(a){for(var b=0;b<a.length;++b){var c=a[b],d=g[c];if(d)h.push(d);else return Promise.reject(Error("Invalid stream ID chosen: "+c))}var e=["audio","video"];h=h.filter(function(a){return 0>e.indexOf(a.a.split("/")[0])?!1:!0});a=h.map(function(a){return a.D.create()});
return Promise.all(a)})).then(I(this,function(a){for(var b=h,c=[],d=0;d<b.length;++d)try{c[d]=this.g.addSourceBuffer(qe(b[d]))}catch(e){}if(b.length!=c.length)a=Error("Error initializing streams."),a.type="storage",a=Promise.reject(a);else{for(d=0;d<a.length;++d)(b=a[d])&&c[d].appendBuffer(b);a=Promise.resolve()}return a})).then(I(this,function(){return lf(e,this.timeoutMs)})).then(I(this,function(){return f?Promise.reject(f):cg(this,h,e.a,this.a.a[0].b)})).then(I(this,function(a){this.R=a;return f?
(dg(this),Promise.reject(f)):Promise.resolve(a)}))};p("shaka.player.OfflineVideoSource.prototype.store",Z.prototype.xa);Z.prototype.Aa=function(a){this.ga=a};Z.prototype.setNetworkCallback=Z.prototype.Aa;Z.prototype.ta=function(a){this.M.push(a.detail.sessionId)};
function cg(a,b,c,d){var e=new Ze(a.Z,a);null!=a.l.segmentRequestTimeout&&(e.b=Number(a.l.segmentRequestTimeout));return Bb(e).then(I(a,function(){return $e(e,b,this.M,d,c)})).then(function(a){Db(e);return Promise.resolve(a)}).catch(function(a){Db(e);return Promise.reject(a)})}
Z.prototype.X=function(){var a=new Jb,b,c;return Bb(a).then(I(this,function(){return Lb(a,this.R)})).then(I(this,function(d){var e=[];this.M=d.session_ids;b=d.duration;c={keySystem:d.key_system,distinctiveIdentifierRequired:d.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:d.audio_robustness,videoRobustness:d.video_robustness,withCredentials:d.with_credentials,licenseServerUrl:d.license_server};for(var f=0;f<d.stream_ids.length;++f)e.push(Mb(a,d.stream_ids[f]));return Promise.all(e)})).then(I(this,
function(a){var e=b,f=c,g=new we;g.c=5;for(var h=new ve,l=0;l<a.length;++l){var m=a[l],n=new oe,t=new ne(m.references),C=new Qd(null,m.init_segment);n.H=t;n.D=C;n.a=m.mime_type;n.b=m.codecs;n.N=!0;this.j&&(null!=this.j.licenseServerUrl&&(f.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(f.withCredentials=this.j.withCredentials),f.licensePostProcessor=this.j.licensePostProcessor,f.licensePreProcessor=this.j.licensePreProcessor,f.serverCertificate=this.j.serverCertificate);
m=gc(f);t=new re;t.m.push(n);t.a.push(m);t.contentType=n.a.split("/")[0];h.a.push(t);h.b=e}g.a.push(h);this.a=g;return X.prototype.X.call(this)})).then(function(){Db(a);return Promise.resolve()}).catch(function(b){Db(a);return Promise.reject(b)})};
Z.prototype.za=function(a,b){a&&(this.j={licenseServerUrl:a.licenseServerUrl,withCredentials:a.withCredentials,serverCertificate:a.serverCertificate,licensePreProcessor:a.licensePreProcessor,licensePostProcessor:a.licensePostProcessor});var c=null;return eg(this).catch(function(a){return b?(c=a,Promise.resolve()):Promise.reject(a)}).then(I(this,function(){return dg(this)})).then(function(){return Promise.resolve(c)})};Z.prototype.deleteGroup=Z.prototype.za;Z.prototype.ua=function(){return this.M};
Z.prototype.ha=function(){return!0};function dg(a){var b=new Ze(null,null);return Bb(b).then(I(a,function(){return cf(b,this.R)})).then(function(){Db(b);return Promise.resolve()}).catch(function(a){Db(b);return Promise.reject(a)})}
function eg(a){var b=document.createElement("video");b.src=window.URL.createObjectURL(a.g);var c=new hf(null,b,a);null!=a.l.licenseRequestTimeout&&(c.w=Number(a.l.licenseRequestTimeout));return a.X().then(function(){return c.initialize()}).then(I(a,function(){return lf(c,this.timeoutMs)})).then(function(){return mf(c)}).then(I(a,function(){c.destroy();this.destroy();return Promise.resolve()})).catch(I(a,function(a){c.destroy();this.destroy();return Promise.reject(a)}))};}.bind(g,this))();
if (typeof(module)!="undefined"&&module.exports)module.exports=g.shaka;
else if (typeof(define)!="undefined" && define.amd)define(function(){return g.shaka});
else this.shaka=g.shaka;
})();

//# sourceMappingURL=shaka-player.compiled.debug.map
